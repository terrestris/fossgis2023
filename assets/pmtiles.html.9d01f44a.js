var z=Object.defineProperty;var E=(e,t,o)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var i=(e,t,o)=>(E(e,typeof t!="symbol"?t+"":t,o),o);import{a as T,J as I,N as M}from"./Source.13d28e10.js";/* empty css           */import{T as S,D as F}from"./WebGLTile.81ec58b8.js";import{a as P,S as V,F as B}from"./featureloader.92da648c.js";import{V as N,a as R,M as Z}from"./VectorTile.f3b960bc.js";import"./TileEventType.16115d42.js";import"./BaseTile.8715c233.js";T();const j=new pmtiles.PMTiles("https://pub-9288c68512ed46eca46ddcade307709b.r2.dev/protomaps-sample-datasets/terrarium_z9.pmtiles");class k{constructor(t){i(this,"url",()=>"pmtiles://"+this._url+"/{z}/{x}/{y}");i(this,"vectorTileLoadFunction",(t,o)=>{const n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),a=o.match(n),r=+a[2],c=+a[3],f=+a[4];t.setLoader((h,et,L)=>{t.setState(1),this._p.getZxy(r,c,f).then(m=>{if(m){const x=t.getFormat().readFeatures(m.data.buffer,{extent:h,featureProjection:L});t.setFeatures(x),t.setState(2)}else t.setState(4)})})});this._url=t,this._p=new pmtiles.PMTiles(t)}}const p=new k("https://r2-public.protomaps.com/protomaps-sample-datasets/nz-buildings-v3.pmtiles"),O=new P({stroke:new V({color:"rgb(93, 63, 211)",width:3}),fill:new B({color:"rgba(180, 63, 211, 0.5)"})}),U=new N({declutter:!0,source:new R({attributions:["\xA9 Land Information New Zealand"],maxZoom:14,format:new Z,url:p.url(),tileLoadFunction:p.vectorTileLoadFunction}),style:O});function _(e){return new Promise((t,o)=>{const n=new Image;n.addEventListener("load",()=>t(n)),n.addEventListener("error",()=>o(new Error("load failed"))),n.src=e})}async function $(e,t,o){const n=await j.getZxy(e,t,o),a=new Blob([n.data]),r=URL.createObjectURL(a),c=await _(r);return URL.revokeObjectURL(r),c}function s(e,t){const o=["band",1,e,t],n=["band",2,e,t],a=["band",3,e,t];return["-",["+",["*",256*256,o],["*",256,n],a],32768]}const w=["*",2,["resolution"]],A=["*",["var","vert"],s(-1,0)],D=["*",["var","vert"],s(1,0)],g=["/",["-",D,A],w],J=["*",["var","vert"],s(0,-1)],W=["*",["var","vert"],s(0,1)],y=["/",["-",W,J],w],b=["atan",["^",["+",["^",g,2],["^",y,2]],.5]],G=["clamp",["atan",["-",0,g],y],-Math.PI,Math.PI],v=["*",Math.PI/180,["var","sunEl"]],X=["*",Math.PI/180,["var","sunAz"]],l=["+",["*",["sin",v],["cos",b]],["*",["*",["cos",v],["sin",b]],["cos",["-",X,G]]]],u={},d=new S({source:new F({loader:$,wrapX:!0,maxZoom:9,attributions:"<a href='https://github.com/tilezen/joerd/blob/master/docs/attribution.md#attribution'>Tilezen J\xF6r\xF0</a>"}),style:{variables:u,color:["array",l,l,l,1]}}),q=["vert","sunEl","sunAz"];q.forEach(function(e){const t=document.getElementById(e),o=document.getElementById(e+"Out");function n(){o.innerText=t.value,u[e]=Number(t.value)}n(),t.addEventListener("input",function(){n(),d.updateStyleVariables(u)})});const C=new I({target:"map",layers:[d,U],view:new M({center:[174.76146587109235,-41.28906462711424],zoom:4})});function H(e){const t=e[0],o=e[1],n=e[2];return t*256+o+n/256-32768}function K([e,t]){const o=t<0?"S":"N",n=e<0?"W":"E";return`${Math.abs(t).toFixed(1)}\xB0 ${o}, ${Math.abs(e).toFixed(1)}\xB0 ${n}`}const Q=document.getElementById("elevationOut"),Y=document.getElementById("locationOut");function tt(e){const t=d.getData(e.pixel);!t||(Q.innerText=H(t).toLocaleString()+" m",Y.innerText=K(e.coordinate))}C.on(["pointermove","click"],tt);
