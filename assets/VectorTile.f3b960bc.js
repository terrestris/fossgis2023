import{l as at,i as Ve,c as lt,M as ct,L as dt,d as ut,e as ht,t as ft,C as gt,f as Oe,g as xt,h as Ae,H as xe,j as pt,k as Tt,r as je,B as yt,m as Ft}from"./featureloader.92da648c.js";import{b9 as wt,aq as Rt,r as Ct,ba as Et,ay as mt,a8 as vt,C as $e,k as ye,m as Fe,b0 as _t,y as We,bb as St,F as Ce,bc as Pt,bd as Dt,aB as It,ao as Lt,ar as Mt,B as R,e as we,h as Gt,W as Ee,j as Vt,f as ke,g as me,be as Be,z as I,o as Ot,n as At,b4 as jt,U as qe,p as K,w as Qe,V as W,aS as ie,bf as kt,q as Bt,bg as Ut,bh as zt,bi as pe,bj as Ue,bk as Nt,A as Kt,bl as bt,E as ze,bm as Zt,b5 as Xt}from"./Source.13d28e10.js";import{j as Ht,k as Yt,I as $t,R as Ne,a as Wt,l as qt,m as Te,e as Je,n as ae,o as et,f as Qt,h as Jt,b as ei,p as ti,q as ii,i as ri}from"./TileEventType.16115d42.js";const Ke=We();class re{constructor(e,i,r,n,s){this.styleFunction,this.extent_,this.id_=s,this.type_=e,this.flatCoordinates_=i,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=r,this.properties_=n}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?wt(this.flatCoordinates_):Rt(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=Ct(this.getExtent());this.flatInteriorPoints_=Et(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=at(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=mt(this.flatCoordinates_,0,this.ends_,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Ve(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let i=0;const r=this.ends_;for(let n=0,s=r.length;n<s;++n){const o=r[n],d=Ve(e,i,o,2,.5);vt(this.flatMidpoints_,d),i=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,i){return this}getProperties(){return this.properties_}getStride(){return 2}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=$e(e);const i=e.getExtent(),r=e.getWorldExtent();if(i&&r){const n=ye(r)/ye(i);Fe(Ke,r[0],r[3],n,-n,0,0,0),_t(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Ke,this.flatCoordinates_)}}getEnds(){return this.ends_}}re.prototype.getEndss=re.prototype.getEnds;re.prototype.getFlatCoordinates=re.prototype.getOrientedFlatCoordinates;const be=re;function ni(t,e){const i=/\{z\}/g,r=/\{x\}/g,n=/\{y\}/g,s=/\{-y\}/g;return function(o,d,c){if(!!o)return t.replace(i,o[0].toString()).replace(r,o[1].toString()).replace(n,o[2].toString()).replace(s,function(){const l=o[0],a=e.getFullTileRange(l);return Ce(a,55),(a.getHeight()-o[2]-1).toString()})}}function si(t,e){const i=t.length,r=new Array(i);for(let n=0;n<i;++n)r[n]=ni(t[n],e);return oi(r)}function oi(t){return t.length===1?t[0]:function(e,i,r){if(!e)return;const n=Ht(e),s=St(n,t.length);return t[s](e,i,r)}}function ai(t){const e=[];let i=/\{([a-z])-([a-z])\}/.exec(t);if(i){const r=i[1].charCodeAt(0),n=i[2].charCodeAt(0);let s;for(s=r;s<=n;++s)e.push(t.replace(i[0],String.fromCharCode(s)));return e}if(i=/\{(\d+)-(\d+)\}/.exec(t),i){const r=parseInt(i[2],10);for(let n=parseInt(i[1],10);n<=r;n++)e.push(t.replace(i[0],n.toString()));return e}return e.push(t),e}var ve={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ve.read=function(t,e,i,r,n){var s,o,d=n*8-r-1,c=(1<<d)-1,l=c>>1,a=-7,u=i?n-1:0,g=i?-1:1,h=t[e+u];for(u+=g,s=h&(1<<-a)-1,h>>=-a,a+=d;a>0;s=s*256+t[e+u],u+=g,a-=8);for(o=s&(1<<-a)-1,s>>=-a,a+=r;a>0;o=o*256+t[e+u],u+=g,a-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)};ve.write=function(t,e,i,r,n,s){var o,d,c,l=s*8-n-1,a=(1<<l)-1,u=a>>1,g=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,f=r?1:-1,x=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(d=isNaN(e)?1:0,o=a):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+u>=1?e+=g/c:e+=g*Math.pow(2,1-u),e*c>=2&&(o++,c/=2),o+u>=a?(d=0,o=a):o+u>=1?(d=(e*c-1)*Math.pow(2,n),o=o+u):(d=e*Math.pow(2,u-1)*Math.pow(2,n),o=0));n>=8;t[i+h]=d&255,h+=f,d/=256,n-=8);for(o=o<<n|d,l+=n;l>0;t[i+h]=o&255,h+=f,o/=256,l-=8);t[i+h-f]|=x*128};var li=C,le=ve;function C(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}C.Varint=0;C.Fixed64=1;C.Bytes=2;C.Fixed32=5;var Re=(1<<16)*(1<<16),Ze=1/Re,ci=12,tt=typeof TextDecoder>"u"?null:new TextDecoder("utf8");C.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,s=this.pos;this.type=r&7,t(n,e,this),this.pos===s&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=ce(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=He(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=ce(this.buf,this.pos)+ce(this.buf,this.pos+4)*Re;return this.pos+=8,t},readSFixed64:function(){var t=ce(this.buf,this.pos)+He(this.buf,this.pos+4)*Re;return this.pos+=8,t},readFloat:function(){var t=le.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=le.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,i,r;return r=e[this.pos++],i=r&127,r<128||(r=e[this.pos++],i|=(r&127)<<7,r<128)||(r=e[this.pos++],i|=(r&127)<<14,r<128)||(r=e[this.pos++],i|=(r&127)<<21,r<128)?i:(r=e[this.pos],i|=(r&15)<<28,di(i,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=ci&&tt?mi(this.buf,e,t):Ei(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==C.Bytes)return t.push(this.readVarint(e));var i=U(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==C.Bytes)return t.push(this.readSVarint());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==C.Bytes)return t.push(this.readBoolean());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==C.Bytes)return t.push(this.readFloat());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==C.Bytes)return t.push(this.readDouble());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==C.Bytes)return t.push(this.readFixed32());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==C.Bytes)return t.push(this.readSFixed32());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==C.Bytes)return t.push(this.readFixed64());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==C.Bytes)return t.push(this.readSFixed64());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===C.Varint)for(;this.buf[this.pos++]>127;);else if(e===C.Bytes)this.pos=this.readVarint()+this.pos;else if(e===C.Fixed32)this.pos+=4;else if(e===C.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Q(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Q(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Q(this.buf,t&-1,this.pos),Q(this.buf,Math.floor(t*Ze),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Q(this.buf,t&-1,this.pos),Q(this.buf,Math.floor(t*Ze),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){ui(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=vi(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Xe(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),le.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),le.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&Xe(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,C.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,gi,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,xi,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,yi,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,pi,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Ti,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Fi,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,wi,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Ri,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Ci,e)},writeBytesField:function(t,e){this.writeTag(t,C.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,C.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,C.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,C.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,C.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,C.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,C.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,C.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,C.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,C.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};function di(t,e,i){var r=i.buf,n,s;if(s=r[i.pos++],n=(s&112)>>4,s<128||(s=r[i.pos++],n|=(s&127)<<3,s<128)||(s=r[i.pos++],n|=(s&127)<<10,s<128)||(s=r[i.pos++],n|=(s&127)<<17,s<128)||(s=r[i.pos++],n|=(s&127)<<24,s<128)||(s=r[i.pos++],n|=(s&1)<<31,s<128))return q(t,n,e);throw new Error("Expected varint not more than 10 bytes")}function U(t){return t.type===C.Bytes?t.readVarint()+t.pos:t.pos+1}function q(t,e,i){return i?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function ui(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(i=~(-t%4294967296),r=~(-t/4294967296),i^4294967295?i=i+1|0:(i=0,r=r+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),hi(i,r,e),fi(r,e)}function hi(t,e,i){i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos]=t&127}function fi(t,e){var i=(t&7)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function Xe(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function gi(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function xi(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function pi(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Ti(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function yi(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Fi(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function wi(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Ri(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Ci(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function ce(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function Q(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function He(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Ei(t,e,i){for(var r="",n=e;n<i;){var s=t[n],o=null,d=s>239?4:s>223?3:s>191?2:1;if(n+d>i)break;var c,l,a;d===1?s<128&&(o=s):d===2?(c=t[n+1],(c&192)===128&&(o=(s&31)<<6|c&63,o<=127&&(o=null))):d===3?(c=t[n+1],l=t[n+2],(c&192)===128&&(l&192)===128&&(o=(s&15)<<12|(c&63)<<6|l&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):d===4&&(c=t[n+1],l=t[n+2],a=t[n+3],(c&192)===128&&(l&192)===128&&(a&192)===128&&(o=(s&15)<<18|(c&63)<<12|(l&63)<<6|a&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,d=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),r+=String.fromCharCode(o),n+=d}return r}function mi(t,e,i){return tt.decode(t.subarray(e,i))}function vi(t,e,i){for(var r=0,n,s;r<e.length;r++){if(n=e.charCodeAt(r),n>55295&&n<57344)if(s)if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||r+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):s=n;continue}else s&&(t[i++]=239,t[i++]=191,t[i++]=189,s=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=n&63|128)}return i}class _i extends lt{constructor(e){super(),e=e||{},this.dataProjection=new Pt({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:be,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,i,r,n){e.pos=i.geometry;const s=e.readVarint()+e.pos;let o=1,d=0,c=0,l=0,a=0,u=0;for(;e.pos<s;){if(!d){const g=e.readVarint();o=g&7,d=g>>3}d--,o===1||o===2?(c+=e.readSVarint(),l+=e.readSVarint(),o===1&&a>u&&(n.push(a),u=a),r.push(c,l),a+=2):o===7?a>u&&(r.push(r[u],r[u+1]),a+=2):Ce(!1,59)}a>u&&(n.push(a),u=a)}createFeature_(e,i,r){const n=i.type;if(n===0)return null;let s;const o=i.properties;let d;this.idProperty_?(d=o[this.idProperty_],delete o[this.idProperty_]):d=i.id,o[this.layerName_]=i.layer.name;const c=[],l=[];this.readRawGeometry_(e,i,c,l);const a=Li(n,l.length);if(this.featureClass_===be)s=new this.featureClass_(a,c,l,o,d),s.transform(r.dataProjection);else{let u;if(a=="Polygon"){const f=Dt(c,l);u=f.length>1?new ct(c,"XY",f):new It(c,"XY",l)}else u=a==="Point"?new Lt(c,"XY"):a==="LineString"?new dt(c,"XY"):a==="MultiPoint"?new ut(c,"XY"):a==="MultiLineString"?new ht(c,"XY",l):null;const g=this.featureClass_;s=new g,this.geometryName_&&s.setGeometryName(this.geometryName_);const h=ft(u,!1,r);s.setGeometry(h),d!==void 0&&s.setId(d),s.setProperties(o,!0)}return s}getType(){return"arraybuffer"}readFeatures(e,i){const r=this.layers_;i=this.adaptOptions(i);const n=$e(i.dataProjection);n.setWorldExtent(i.extent),i.dataProjection=n;const s=new li(e),o=s.readFields(Si,{}),d=[];for(const c in o){if(r&&!r.includes(c))continue;const l=o[c],a=l?[0,0,l.extent,l.extent]:null;n.setExtent(a);for(let u=0,g=l.length;u<g;++u){const h=Ii(s,l,u),f=this.createFeature_(s,h,i);f!==null&&d.push(f)}}return d}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function Si(t,e,i){if(t===3){const r={keys:[],values:[],features:[]},n=i.readVarint()+i.pos;i.readFields(Pi,r,n),r.length=r.features.length,r.length&&(e[r.name]=r)}}function Pi(t,e,i){if(t===15)e.version=i.readVarint();else if(t===1)e.name=i.readString();else if(t===5)e.extent=i.readVarint();else if(t===2)e.features.push(i.pos);else if(t===3)e.keys.push(i.readString());else if(t===4){let r=null;const n=i.readVarint()+i.pos;for(;i.pos<n;)t=i.readVarint()>>3,r=t===1?i.readString():t===2?i.readFloat():t===3?i.readDouble():t===4?i.readVarint64():t===5?i.readVarint():t===6?i.readSVarint():t===7?i.readBoolean():null;e.values.push(r)}}function Di(t,e,i){if(t==1)e.id=i.readVarint();else if(t==2){const r=i.readVarint()+i.pos;for(;i.pos<r;){const n=e.layer.keys[i.readVarint()],s=e.layer.values[i.readVarint()];e.properties[n]=s}}else t==3?e.type=i.readVarint():t==4&&(e.geometry=i.pos)}function Ii(t,e,i){t.pos=e.features[i];const r=t.readVarint()+t.pos,n={layer:e,type:0,properties:{}};return t.readFields(Di,n,r),n}function Li(t,e){let i;return t===1?i=e===1?"Point":"MultiPoint":t===2?i=e===1?"LineString":"MultiLineString":t===3&&(i="Polygon"),i}const $i=_i;class Mi extends gt{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Mt(),this.tmpTileRange_=new Yt(0,0,0,0)}isDrawableTile(e){const i=this.getLayer(),r=e.getState(),n=i.getUseInterimTilesOnError();return r==R.LOADED||r==R.EMPTY||r==R.ERROR&&!n}getTile(e,i,r,n){const s=n.pixelRatio,o=n.viewState.projection,d=this.getLayer();let l=d.getSource().getTile(e,i,r,s,o);return l.getState()==R.ERROR&&d.getUseInterimTilesOnError()&&d.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(l)||(l=l.getInterimTile()),l}getData(e){const i=this.frameState;if(!i)return null;const r=this.getLayer(),n=we(i.pixelToCoordinateTransform,e.slice()),s=r.getExtent();if(s&&!Gt(s,n))return null;const o=i.pixelRatio,d=i.viewState.projection,c=i.viewState,l=r.getRenderSource(),a=l.getTileGridForProjection(c.projection),u=l.getTilePixelRatio(i.pixelRatio);for(let g=a.getZForResolution(c.resolution);g>=a.getMinZoom();--g){const h=a.getTileCoordForCoordAndZ(n,g),f=l.getTile(g,h[1],h[2],o,d);if(!(f instanceof $t||f instanceof Ne)||f instanceof Ne&&f.getState()===R.EMPTY)return null;if(f.getState()!==R.LOADED)continue;const x=a.getOrigin(g),F=Ee(a.getTileSize(g)),w=a.getResolution(g),T=Math.floor(u*((n[0]-x[0])/w-h[1]*F[0])),p=Math.floor(u*((x[1]-n[1])/w-h[2]*F[1])),y=Math.round(u*l.getGutterForProjection(c.projection));return this.getImageData(f.getImage(),T+y,p+y)}return null}loadedTileCallback(e,i,r){return this.isDrawableTile(r)?super.loadedTileCallback(e,i,r):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,i){const r=e.layerStatesArray[e.layerIndex],n=e.viewState,s=n.projection,o=n.resolution,d=n.center,c=n.rotation,l=e.pixelRatio,a=this.getLayer(),u=a.getSource(),g=u.getRevision(),h=u.getTileGridForProjection(s),f=h.getZForResolution(o,u.zDirection),x=h.getResolution(f);let F=e.extent;const w=e.viewState.resolution,T=u.getTilePixelRatio(l),p=Math.round(Vt(F)/w*l),y=Math.round(ye(F)/w*l),E=r.extent&&ke(r.extent,s);E&&(F=me(F,ke(r.extent,s)));const m=x*p/2/T,P=x*y/2/T,v=[d[0]-m,d[1]-P,d[0]+m,d[1]+P],S=h.getTileRangeForExtentAndZ(F,f),L={};L[f]={};const D=this.createLoadedTileFinder(u,s,L),b=this.tmpExtent,ne=this.tmpTileRange_;this.newTiles_=!1;const de=c?Be(n.center,w,c,e.size):void 0;for(let z=S.minX;z<=S.maxX;++z)for(let G=S.minY;G<=S.maxY;++G){if(c&&!h.tileCoordIntersectsViewport([f,z,G],de))continue;const V=this.getTile(f,z,G,e);if(this.isDrawableTile(V)){const H=I(this);if(V.getState()==R.LOADED){L[f][V.tileCoord.toString()]=V;let Y=V.inTransition(H);Y&&r.opacity!==1&&(V.endTransition(H),Y=!1),!this.newTiles_&&(Y||!this.renderedTiles.includes(V))&&(this.newTiles_=!0)}if(V.getAlpha(H,e.time)===1)continue}const he=h.getTileCoordChildTileRange(V.tileCoord,ne,b);let J=!1;he&&(J=D(f+1,he)),J||h.forEachTileCoordParentTileRange(V.tileCoord,D,ne,b)}const Z=x/o*l/T;Fe(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/l,1/l,c,-p/2,-y/2);const M=Ot(this.pixelTransform);this.useContainer(i,M,this.getBackground(e));const _=this.context,O=_.canvas;At(this.inversePixelTransform,this.pixelTransform),Fe(this.tempTransform,p/2,y/2,Z,Z,0,-p/2,-y/2),O.width!=p||O.height!=y?(O.width=p,O.height=y):this.containerReused||_.clearRect(0,0,p,y),E&&this.clipUnrotated(_,e,E),u.getInterpolate()||(_.imageSmoothingEnabled=!1),this.preRender(_,e),this.renderedTiles.length=0;let N=Object.keys(L).map(Number);N.sort(jt);let X,ue,j;r.opacity===1&&(!this.containerReused||u.getOpaque(e.viewState.projection))?N=N.reverse():(X=[],ue=[]);for(let z=N.length-1;z>=0;--z){const G=N[z],V=u.getTilePixelSize(G,l,s),J=h.getResolution(G)/x,H=V[0]*J*Z,Y=V[1]*J*Z,fe=h.getTileCoordForCoordAndZ(qe(v),G),Se=h.getTileCoordExtent(fe),se=we(this.tempTransform,[T*(Se[0]-v[0])/x,T*(v[3]-Se[3])/x]),it=T*u.getGutterForProjection(s),Pe=L[G];for(const rt in Pe){const $=Pe[rt],De=$.tileCoord,Ie=fe[1]-De[1],nt=Math.round(se[0]-(Ie-1)*H),Le=fe[2]-De[2],st=Math.round(se[1]-(Le-1)*Y),k=Math.round(se[0]-Ie*H),B=Math.round(se[1]-Le*Y),ee=nt-k,te=st-B,Me=f===G,Ge=Me&&$.getAlpha(I(this),e.time)!==1;let ge=!1;if(!Ge)if(X){j=[k,B,k+ee,B,k+ee,B+te,k,B+te];for(let oe=0,ot=X.length;oe<ot;++oe)if(f!==G&&G<ue[oe]){const A=X[oe];K([k,B,k+ee,B+te],[A[0],A[3],A[4],A[7]])&&(ge||(_.save(),ge=!0),_.beginPath(),_.moveTo(j[0],j[1]),_.lineTo(j[2],j[3]),_.lineTo(j[4],j[5]),_.lineTo(j[6],j[7]),_.moveTo(A[6],A[7]),_.lineTo(A[4],A[5]),_.lineTo(A[2],A[3]),_.lineTo(A[0],A[1]),_.clip())}X.push(j),ue.push(G)}else _.clearRect(k,B,ee,te);this.drawTileImage($,e,k,B,ee,te,it,Me),X&&!Ge?(ge&&_.restore(),this.renderedTiles.unshift($)):this.renderedTiles.push($),this.updateUsedTiles(e.usedTiles,u,$)}}return this.renderedRevision=g,this.renderedResolution=x,this.extentChanged=!this.renderedExtent_||!Qe(this.renderedExtent_,v),this.renderedExtent_=v,this.renderedPixelRatio=l,this.renderedProjection=s,this.manageTilePyramid(e,u,h,l,s,F,f,a.getPreload()),this.scheduleExpireCache(e,u),this.postRender(_,e),r.extent&&_.restore(),_.imageSmoothingEnabled=!0,M!==O.style.transform&&(O.style.transform=M),this.container}drawTileImage(e,i,r,n,s,o,d,c){const l=this.getTileImage(e);if(!l)return;const a=I(this),u=i.layerStatesArray[i.layerIndex],g=u.opacity*(c?e.getAlpha(a,i.time):1),h=g!==this.context.globalAlpha;h&&(this.context.save(),this.context.globalAlpha=g),this.context.drawImage(l,d,d,l.width-2*d,l.height-2*d,r,n,s,o),h&&this.context.restore(),g!==u.opacity?i.animate=!0:c&&e.endTransition(a)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,i){if(i.canExpireCache()){const r=function(n,s,o){const d=I(n);d in o.usedTiles&&n.expireCache(o.viewState.projection,o.usedTiles[d])}.bind(null,i);e.postRenderFunctions.push(r)}}updateUsedTiles(e,i,r){const n=I(i);n in e||(e[n]={}),e[n][r.getKey()]=!0}manageTilePyramid(e,i,r,n,s,o,d,c,l){const a=I(i);a in e.wantedTiles||(e.wantedTiles[a]={});const u=e.wantedTiles[a],g=e.tileQueue,h=r.getMinZoom(),f=e.viewState.rotation,x=f?Be(e.viewState.center,e.viewState.resolution,f,e.size):void 0;let F=0,w,T,p,y,E,m;for(m=h;m<=d;++m)for(T=r.getTileRangeForExtentAndZ(o,m,T),p=r.getResolution(m),y=T.minX;y<=T.maxX;++y)for(E=T.minY;E<=T.maxY;++E)f&&!r.tileCoordIntersectsViewport([m,y,E],x)||(d-m<=c?(++F,w=i.getTile(m,y,E,n,s),w.getState()==R.IDLE&&(u[w.getKey()]=!0,g.isKeyQueued(w.getKey())||g.enqueue([w,a,r.getTileCoordCenter(w.tileCoord),p])),l!==void 0&&l(w)):i.useTile(m,y,E,s));i.updateCacheSize(F,s)}}const Gi=Mi;class _e extends Wt{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===_e.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const i=e.target,r=I(i),n=i.getState();let s;n==R.LOADING?(this.tileLoadingKeys_[r]=!0,s=Te.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],s=n==R.ERROR?Te.TILELOADERROR:n==R.LOADED?Te.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new qt(s,i))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,i){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof i<"u"?this.setKey(i):this.changed()}setUrl(e){const i=ai(e);this.urls=i,this.setUrls(i)}setUrls(e){this.urls=e;const i=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(si(e,this.tileGrid),i):this.setKey(i)}tileUrlFunction(e,i,r){}useTile(e,i,r){const n=Je(e,i,r);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}const Vi=_e,Oi={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},Ai={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class ji extends Gi{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=We()}prepareTile(e,i,r){let n;const s=e.getState();return(s===R.LOADED||s===R.ERROR)&&(this.updateExecutorGroup_(e,i,r),this.tileImageNeedsRender_(e)&&(n=!0)),n}getTile(e,i,r,n){const s=n.pixelRatio,o=n.viewState,d=o.resolution,c=o.projection,l=this.getLayer(),a=l.getSource().getTile(e,i,r,s,c),u=n.viewHints,g=!(u[W.ANIMATING]||u[W.INTERACTING]);return(g||!a.wantedResolution)&&(a.wantedResolution=d),this.prepareTile(a,s,c)&&(g||Date.now()-n.time<8)&&l.getRenderMode()!=="vector"&&this.renderTileImage_(a,n),super.getTile(e,i,r,n)}isDrawableTile(e){const i=this.getLayer();return super.isDrawableTile(e)&&(i.getRenderMode()==="vector"?I(i)in e.executorGroups:e.hasContext(i))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const i=this.getLayer().getRevision();return this.renderedLayerRevision_!==i&&(this.renderedLayerRevision_=i,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,i,r){const n=this.getLayer(),s=n.getRevision(),o=n.getRenderOrder()||null,d=e.wantedResolution,c=e.getReplayState(n);if(!c.dirty&&c.renderedResolution===d&&c.renderedRevision==s&&c.renderedRenderOrder==o)return;const l=n.getSource(),a=n.getDeclutter(),u=l.getTileGrid(),h=l.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),f=l.getSourceTiles(i,r,e),x=I(n);delete e.hitDetectionImageData[x],e.executorGroups[x]=[],a&&(e.declutterExecutorGroups[x]=[]),c.dirty=!1;for(let F=0,w=f.length;F<w;++F){const T=f[F];if(T.getState()!=R.LOADED)continue;const p=T.tileCoord,y=u.getTileCoordExtent(p),E=me(h,y),m=ie(E,n.getRenderBuffer()*d,this.tmpExtent),P=Qe(y,E)?null:m,v=new Oe(0,m,d,i),S=a?new Oe(0,E,d,i):void 0,L=xt(d,i),D=function(M){let _;const O=M.getStyleFunction()||n.getStyleFunction();if(O&&(_=O(M,d)),_){const N=this.renderFeature(M,L,_,v,S);c.dirty=c.dirty||N}},b=T.getFeatures();o&&o!==c.renderedRenderOrder&&b.sort(o);for(let M=0,_=b.length;M<_;++M){const O=b[M];(!P||K(P,O.getGeometry().getExtent()))&&D.call(this,O)}const ne=v.finish(),de=n.getRenderMode()!=="vector"&&a&&f.length===1?null:E,Z=new Ae(de,d,i,l.getOverlaps(),ne,n.getRenderBuffer());if(e.executorGroups[x].push(Z),S){const M=new Ae(null,d,i,l.getOverlaps(),S.finish(),n.getRenderBuffer());e.declutterExecutorGroups[x].push(M)}}c.renderedRevision=s,c.renderedRenderOrder=o,c.renderedResolution=d}forEachFeatureAtCoordinate(e,i,r,n,s){const o=i.viewState.resolution,d=i.viewState.rotation;r=r==null?0:r;const c=this.getLayer(),a=c.getSource().getTileGridForProjection(i.viewState.projection),u=kt([e]);ie(u,o*r,u);const g={},h=function(F,w,T){let p=F.getId();p===void 0&&(p=I(F));const y=g[p];if(y){if(y!==!0&&T<y.distanceSq){if(T===0)return g[p]=!0,s.splice(s.lastIndexOf(y),1),n(F,c,w);y.geometry=w,y.distanceSq=T}}else{if(T===0)return g[p]=!0,n(F,c,w);s.push(g[p]={feature:F,layer:c,geometry:w,distanceSq:T,callback:n})}},f=this.renderedTiles;let x;for(let F=0,w=f.length;!x&&F<w;++F){const T=f[F],p=a.getTileCoordExtent(T.wrappedTileCoord);if(!K(p,u))continue;const y=I(c),E=[T.executorGroups[y]],m=T.declutterExecutorGroups[y];m&&E.push(m),E.some(P=>{const v=P===m?i.declutterTree.all().map(S=>S.value):null;for(let S=0,L=P.length;S<L;++S)if(x=P[S].forEachFeatureAtCoordinate(e,o,d,r,h,v),x)return!0})}return x}getFeatures(e){return new Promise((i,r)=>{const n=this.getLayer(),s=I(n),o=n.getSource(),d=this.renderedProjection,c=d.getExtent(),l=this.renderedResolution,a=o.getTileGridForProjection(d),u=we(this.renderedPixelToCoordinateTransform_,e.slice()),g=a.getTileCoordForCoordAndResolution(u,l);let h;for(let p=0,y=this.renderedTiles.length;p<y;++p)if(g.toString()===this.renderedTiles[p].tileCoord.toString()){if(h=this.renderedTiles[p],h.getState()===R.LOADED){const E=a.getTileCoordExtent(h.tileCoord);o.getWrapX()&&d.canWrapX()&&!Bt(c,E)&&Ut(u,d);break}h=void 0}if(!h||h.loadingSourceTiles>0){i([]);return}const f=a.getTileCoordExtent(h.wrappedTileCoord),x=qe(f),F=[(u[0]-x[0])/l,(x[1]-u[1])/l],w=h.getSourceTiles().reduce(function(p,y){return p.concat(y.getFeatures())},[]);let T=h.hitDetectionImageData[s];if(!T){const p=Ee(a.getTileSize(a.getZForResolution(l,o.zDirection))),y=this.renderedRotation_,E=[this.getRenderTransform(a.getTileCoordCenter(h.wrappedTileCoord),l,0,xe,p[0]*xe,p[1]*xe,0)];T=pt(p,E,w,n.getStyleFunction(),a.getTileCoordExtent(h.wrappedTileCoord),h.getReplayState(n).renderedResolution,y),h.hitDetectionImageData[s]=T}i(Tt(F,w,T))})}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e){const i=this.context,r=i.globalAlpha;i.globalAlpha=this.getLayer().getOpacity();const n=e.viewHints,s=!(n[W.ANIMATING]||n[W.INTERACTING]),o=this.renderedTiles;for(let d=0,c=o.length;d<c;++d){const l=o[d],a=l.declutterExecutorGroups[I(this.getLayer())];if(a)for(let u=a.length-1;u>=0;--u)a[u].execute(this.context,1,this.getTileRenderTransform(l,e),e.viewState.rotation,s,void 0,e.declutterTree)}i.globalAlpha=r}getTileRenderTransform(e,i){const r=i.pixelRatio,n=i.viewState,s=n.center,o=n.resolution,d=n.rotation,c=i.size,l=Math.round(c[0]*r),a=Math.round(c[1]*r),g=this.getLayer().getSource().getTileGridForProjection(i.viewState.projection),h=e.tileCoord,f=g.getTileCoordExtent(e.wrappedTileCoord),x=g.getTileCoordExtent(h,this.tmpExtent)[0]-f[0];return zt(pe(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(s,o,d,r,l,a,x))}postRender(e,i){const r=i.viewHints,n=!(r[W.ANIMATING]||r[W.INTERACTING]);this.renderedPixelToCoordinateTransform_=i.pixelToCoordinateTransform.slice(),this.renderedRotation_=i.viewState.rotation;const s=this.getLayer(),o=s.getRenderMode(),d=e.globalAlpha;e.globalAlpha=s.getOpacity();const c=Ai[o],l=i.viewState,a=l.rotation,u=s.getSource(),h=u.getTileGridForProjection(l.projection).getZForResolution(l.resolution,u.zDirection),f=this.renderedTiles,x=[],F=[];let w=!0;for(let T=f.length-1;T>=0;--T){const p=f[T];w=w&&!p.getReplayState(s).dirty;const y=p.executorGroups[I(s)].filter(S=>S.hasExecutors(c));if(y.length===0)continue;const E=this.getTileRenderTransform(p,i),m=p.tileCoord[0];let P=!1;const v=y[0].getClipCoords(E);if(v){for(let S=0,L=x.length;S<L;++S)if(h!==m&&m<F[S]){const D=x[S];K([v[0],v[3],v[4],v[7]],[D[0],D[3],D[4],D[7]])&&(P||(e.save(),P=!0),e.beginPath(),e.moveTo(v[0],v[1]),e.lineTo(v[2],v[3]),e.lineTo(v[4],v[5]),e.lineTo(v[6],v[7]),e.moveTo(D[6],D[7]),e.lineTo(D[4],D[5]),e.lineTo(D[2],D[3]),e.lineTo(D[0],D[1]),e.clip())}x.push(v),F.push(m)}for(let S=0,L=y.length;S<L;++S)y[S].execute(e,1,E,a,n,c);P&&e.restore()}e.globalAlpha=d,this.ready=w,super.postRender(e,i)}renderFeature(e,i,r,n,s){if(!r)return!1;let o=!1;if(Array.isArray(r))for(let d=0,c=r.length;d<c;++d)o=je(n,e,r[d],i,this.boundHandleStyleImageChange_,void 0,s)||o;else o=je(n,e,r,i,this.boundHandleStyleImageChange_,void 0,s);return o}tileImageNeedsRender_(e){const i=this.getLayer();if(i.getRenderMode()==="vector")return!1;const r=e.getReplayState(i),n=i.getRevision(),s=e.wantedResolution;return r.renderedTileResolution!==s||r.renderedTileRevision!==n}renderTileImage_(e,i){const r=this.getLayer(),n=e.getReplayState(r),s=r.getRevision(),o=e.executorGroups[I(r)];n.renderedTileRevision=s;const d=e.wrappedTileCoord,c=d[0],l=r.getSource();let a=i.pixelRatio;const g=i.viewState.projection,h=l.getTileGridForProjection(g),f=h.getResolution(e.tileCoord[0]),x=i.pixelRatio/e.wantedResolution*f,F=h.getResolution(c),w=e.getContext(r);a=Math.round(Math.max(a,x/a));const T=l.getTilePixelSize(c,a,g);w.canvas.width=T[0],w.canvas.height=T[1];const p=a/x;if(p!==1){const P=Ue(this.tmpTransform_);pe(P,p,p),w.setTransform.apply(w,P)}const y=h.getTileCoordExtent(d,this.tmpExtent),E=x/F,m=Ue(this.tmpTransform_);pe(m,E,-E),Nt(m,-y[0],-y[3]);for(let P=0,v=o.length;P<v;++P)o[P].execute(w,p,m,0,!0,Oi[r.getRenderMode()]);n.renderedTileResolution=e.wantedResolution}}const ki=ji;class Bi extends yt{constructor(e){e=e||{};const i=Object.assign({},e);delete i.preload,delete i.useInterimTilesOnError,super(i),this.on,this.once,this.un;const r=e.renderMode||"hybrid";Ce(r=="hybrid"||r=="vector",28),this.renderMode_=r,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new ki(this)}getFeatures(e){return super.getFeatures(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(ae.PRELOAD)}getUseInterimTilesOnError(){return this.get(ae.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(ae.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(ae.USE_INTERIM_TILES_ON_ERROR,e)}}const Wi=Bi;class Ui extends et{constructor(e,i,r,n,s,o){super(e,i,o),this.extent=null,this.format_=n,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=s,this.url_=r,this.key=r}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==R.IDLE&&(this.setState(R.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,i){this.setFeatures(e)}onError(){this.setState(R.ERROR)}setFeatures(e){this.features_=e,this.setState(R.LOADED)}setLoader(e){this.loader_=e}}const zi=Ui,Ye=[];class Ni extends et{constructor(e,i,r,n){super(e,i,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=n.bind(void 0,this),this.wrappedTileCoord=r}getContext(e){const i=I(e);return i in this.context_||(this.context_[i]=Kt(1,1,Ye)),this.context_[i]}hasContext(e){return I(e)in this.context_}getImage(e){return this.hasContext(e)?this.getContext(e).canvas:null}getReplayState(e){const i=I(e);return i in this.replayState_||(this.replayState_[i]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[i]}load(){this.getSourceTiles()}release(){for(const e in this.context_){const i=this.context_[e];bt(i),Ye.push(i.canvas),delete this.context_[e]}super.release()}}const Ki=Ni;class bi extends Vi{constructor(e){const i=e.projection||"EPSG:3857",r=e.extent||Qt(i),n=e.tileGrid||Jt({extent:r,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:i,state:e.state,tileGrid:n,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Zi,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.sourceTileCache=new ei(this.tileCache.highWaterMark),this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:zi,this.tileGrids_={}}getFeaturesInExtent(e){const i=[],r=this.tileCache;if(r.getCount()===0)return i;const n=ti(r.peekFirstKey())[0],s=this.tileGrid;return r.forEach(function(o){if(o.tileCoord[0]!==n||o.getState()!==R.LOADED)return;const d=o.getSourceTiles();for(let c=0,l=d.length;c<l;++c){const a=d[c],u=a.tileCoord;if(K(e,s.getTileCoordExtent(u))){const g=a.getFeatures();if(g)for(let h=0,f=g.length;h<f;++h){const x=g[h],F=x.getGeometry();K(e,F.getExtent())&&i.push(x)}}}}),i}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(e,i){const r=this.getTileCacheForProjection(e),n=Object.keys(i).reduce((s,o)=>{const d=ii(o),c=r.peek(d);if(c){const l=c.sourceTiles;for(let a=0,u=l.length;a<u;++a)s[l[a].getKey()]=!0}return s},{});super.expireCache(e,i),this.sourceTileCache.expireCache(n)}getSourceTiles(e,i,r){if(r.getState()===R.IDLE){r.setState(R.LOADING);const n=r.wrappedTileCoord,s=this.getTileGridForProjection(i),o=s.getTileCoordExtent(n),d=n[0],c=s.getResolution(d);ie(o,-c,o);const l=this.tileGrid,a=l.getExtent();a&&me(o,a,o);const u=l.getZForResolution(c,this.zDirection);l.forEachTileCoord(o,u,g=>{const h=this.tileUrlFunction(g,e,i),f=this.sourceTileCache.containsKey(h)?this.sourceTileCache.get(h):new this.tileClass(g,h?R.IDLE:R.EMPTY,h,this.format_,this.tileLoadFunction);r.sourceTiles.push(f);const x=f.getState();if(x<R.LOADED){const F=w=>{this.handleTileChange(w);const T=f.getState();if(T===R.LOADED||T===R.ERROR){const p=f.getKey();p in r.errorTileKeys?f.getState()===R.LOADED&&delete r.errorTileKeys[p]:r.loadingSourceTiles--,T===R.ERROR?r.errorTileKeys[p]=!0:f.removeEventListener(ze.CHANGE,F),r.loadingSourceTiles===0&&r.setState(Xt(r.errorTileKeys)?R.LOADED:R.ERROR)}};f.addEventListener(ze.CHANGE,F),r.loadingSourceTiles++}x===R.IDLE&&(f.extent=l.getTileCoordExtent(g),f.projection=i,f.resolution=l.getResolution(g[0]),this.sourceTileCache.set(h,f),f.load())}),r.loadingSourceTiles||r.setState(r.sourceTiles.some(g=>g.getState()===R.ERROR)?R.ERROR:R.LOADED)}return r.sourceTiles}getTile(e,i,r,n,s){const o=Je(e,i,r),d=this.getKey();let c;if(this.tileCache.containsKey(o)&&(c=this.tileCache.get(o),c.key===d))return c;const l=[e,i,r];let a=this.getTileCoordForTileUrlFunction(l,s);const u=this.getTileGrid().getExtent(),g=this.getTileGridForProjection(s);if(a&&u){const x=g.getTileCoordExtent(a);ie(x,-g.getResolution(e),x),K(u,x)||(a=null)}let h=!0;if(a!==null){const x=this.tileGrid,F=g.getResolution(e),w=x.getZForResolution(F,1),T=g.getTileCoordExtent(a);ie(T,-F,T),x.forEachTileCoord(T,w,p=>{h=h&&!this.tileUrlFunction(p,n,s)})}const f=new Ki(l,h?R.EMPTY:R.IDLE,a,this.getSourceTiles.bind(this,n,s));return f.key=d,c?(f.interimTile=c,f.refreshInterimChain(),this.tileCache.replace(o,f)):this.tileCache.set(o,f),f}getTileGridForProjection(e){const i=e.getCode();let r=this.tileGrids_[i];if(!r){const n=this.tileGrid,s=n.getResolutions().slice(),o=s.map(function(l,a){return n.getOrigin(a)}),d=s.map(function(l,a){return n.getTileSize(a)}),c=Zt+1;for(let l=s.length;l<c;++l)s.push(s[l-1]/2),o.push(o[l-1]),d.push(d[l-1]);r=new ri({extent:n.getExtent(),origins:o,resolutions:s,tileSizes:d}),this.tileGrids_[i]=r}return r}getTilePixelRatio(e){return e}getTilePixelSize(e,i,r){const n=this.getTileGridForProjection(r),s=Ee(n.getTileSize(e),this.tmpSize);return[Math.round(s[0]*i),Math.round(s[1]*i)]}updateCacheSize(e,i){super.updateCacheSize(e*2,i),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(i).highWaterMark}}const qi=bi;function Zi(t,e){t.setLoader(function(i,r,n){Ft(e,t.getFormat(),i,r,n,t.onLoad.bind(t),t.onError.bind(t))})}export{Gi as C,$i as M,be as R,Vi as U,Wi as V,qi as a,si as c,Zi as d,ai as e};
