import{a as G}from"./VectorTile.bbb61dcc.js";import{d as V}from"./TileEventType.49efe80f.js";import{g as U,r as E}from"./net.f25ef960.js";import{A as W,g as F,bO as H}from"./Source.c163b9e6.js";const L={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},X={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function _(r,e){let l,i;for(let o=0;o<r.length;++o){const a=r[o];if(a.rel==="item"){if(a.type===e){l=a.href;break}(L[a.type]||!i&&a.type.startsWith("image/"))&&(i=a.href)}}if(!l)if(i)l=i;else throw new Error('Could not find "item" link');return l}function Y(r,e,l){let i,o;const a={};for(let c=0;c<r.length;++c){const n=r[c];if(a[n.type]=n.href,n.rel==="item"){if(n.type===e){i=n.href;break}X[n.type]&&(o=n.href)}}if(!i&&l)for(let c=0;c<l.length;++c){const n=l[c];if(a[n]){i=a[n];break}}if(!i)if(o)i=o;else throw new Error('Could not find "item" link');return i}function j(r,e,l,i){let o=r.projection;if(!o&&(o=W(e.crs),!o))throw new Error(`Unsupported CRS: ${e.crs}`);const a=o.getAxisOrientation().substr(0,2)!=="en",c=e.tileMatrices,n={};for(let t=0;t<c.length;++t){const f=c[t];n[f.id]=f}const x={},g=[];if(i)for(let t=0;t<i.length;++t){const f=i[t],s=f.tileMatrix;g.push(s),x[s]=f}else for(let t=0;t<c.length;++t){const f=c[t].id;g.push(f)}const T=g.length,u=new Array(T),O=new Array(T),z=new Array(T),R=new Array(T),y=[-1/0,-1/0,1/0,1/0];for(let t=0;t<T;++t){const f=g[t],s=n[f],h=s.pointOfOrigin;a?u[t]=[h[1],h[0]]:u[t]=h,O[t]=s.cellSize,z[t]=[s.matrixWidth,s.matrixHeight],R[t]=[s.tileWidth,s.tileHeight];const p=x[f];if(p){const w=s.cellSize*s.tileWidth,d=u[t][0]+p.minTileCol*w,b=u[t][0]+(p.maxTileCol+1)*w,m=s.cellSize*s.tileHeight,k=s.cornerOfOrigin==="bottomLeft";let M,C;k?(M=u[t][1]+p.minTileRow*m,C=u[t][1]+(p.maxTileRow+1)*m):(M=u[t][1]-(p.maxTileRow+1)*m,C=u[t][1]-p.minTileRow*m),F(y,[d,M,b,C],y)}}const S=new V({origins:u,resolutions:O,sizes:z,tileSizes:R,extent:i?y:void 0}),v=r.context,A=r.url;function D(t,f,s){if(!t)return;const h=g[t[0]],p=n[h],w=p.cornerOfOrigin==="bottomLeft",d={tileMatrix:h,tileCol:t[1],tileRow:w?-t[2]-1:t[2]};if(i){const m=x[p.id];if(d.tileCol<m.minTileCol||d.tileCol>m.maxTileCol||d.tileRow<m.minTileRow||d.tileRow>m.maxTileRow)return}Object.assign(d,v);const b=l.replace(/\{(\w+?)\}/g,function(m,k){return d[k]});return E(A,b)}return{grid:S,urlTemplate:l,urlFunction:D}}function $(r,e){const l=e.tileMatrixSetLimits;let i;if(e.dataType==="map")i=_(e.links,r.mediaType);else if(e.dataType==="vector")i=Y(e.links,r.mediaType,r.supportedMediaTypes);else throw new Error('Expected tileset data type to be "map" or "vector"');if(e.tileMatrixSet)return j(r,e.tileMatrixSet,i,l);const o=e.links.find(n=>n.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!o)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const a=o.href,c=E(r.url,a);return U(c).then(function(n){return j(r,n,i,l)})}function J(r){return U(r.url).then(function(e){return $(r,e)})}class N extends G{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"});const l={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null};J(l).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){H(e),this.setState("error")}}const K=N;export{K as O};
