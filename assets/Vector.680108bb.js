import{bg as oe,u as W,l as K,E as Z,C as S,az as j,V as b,j as N,z as ae,aW as he,bh as ue,n as le,o as ce,f as de,p as fe,q as D,e as _e,al as ge,aR as me,bi as ye,a5 as xe,bj as M,bk as Ee,F as pe,y as R,Q as Ce,w as ee,aC as V,au as Re,S as Ie,aF as Fe,bl as ve,bm as Ge,bn as P,aK as Ae,bo as we,B as Te,bp as De}from"./Source.c163b9e6.js";import{C as Le,f as Y,H as T,e as be,h as Ne,c as $,i as z,g as Se,d as k,r as q,j as Oe,B as Ue,R as Xe,x as J}from"./featureloader.66bc25dd.js";class B extends oe{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new B(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const n=this.getStyle();return n&&e.setStyle(n),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(W(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=K(e,Z.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?We(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function We(E){if(typeof E=="function")return E;let e;return Array.isArray(E)?e=E:(S(typeof E.getZIndex=="function",41),e=[E]),function(){return e}}const $e=B;class Ke extends Le{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=j(),this.wrappedRenderedExtent_=j(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,n){const s=t.extent,r=t.viewState,i=r.center,o=r.resolution,a=r.projection,l=r.rotation,h=a.getExtent(),u=this.getLayer().getSource(),c=t.pixelRatio,y=t.viewHints,g=!(y[b.ANIMATING]||y[b.INTERACTING]),f=this.compositionContext_,m=Math.round(t.size[0]*c),d=Math.round(t.size[1]*c),p=u.getWrapX()&&a.canWrapX(),I=p?N(h):null,v=p?Math.ceil((s[2]-h[2])/I)+1:1;let w=p?Math.floor((s[0]-h[0])/I):0;do{const A=this.getRenderTransform(i,o,l,c,m,d,w*I);e.execute(f,1,A,l,g,void 0,n)}while(++w<v)}setupCompositionContext_(){if(this.opacity_!==1){const e=ae(this.context.canvas.width,this.context.canvas.height,Y);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,he(this.compositionContext_),Y.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())}renderFrame(e,t){const n=e.pixelRatio,s=e.layerStatesArray[e.layerIndex];ue(this.pixelTransform,1/n,1/n),le(this.inversePixelTransform,this.pixelTransform);const r=ce(this.pixelTransform);this.useContainer(t,r,this.getBackground(e));const i=this.context,o=i.canvas,a=this.replayGroup_,l=this.declutterExecutorGroup;if((!a||a.isEmpty())&&(!l||l.isEmpty()))return null;const h=Math.round(e.size[0]*n),u=Math.round(e.size[1]*n);o.width!=h||o.height!=u?(o.width=h,o.height=u,o.style.transform!==r&&(o.style.transform=r)):this.containerReused||i.clearRect(0,0,h,u),this.preRender(i,e);const c=e.viewState,y=c.projection;this.opacity_=s.opacity,this.setupCompositionContext_();let g=!1,f=!0;if(s.extent&&this.clipping){const m=de(s.extent,y);f=fe(m,e.extent),g=f&&!D(m,e.extent),g&&this.clipUnrotated(this.compositionContext_,e,m)}return f&&this.renderWorlds(a,e),g&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(i,e),this.renderedRotation_!==c.rotation&&(this.renderedRotation_=c.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise(t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=[this.context.canvas.width,this.context.canvas.height];_e(this.pixelTransform,n);const s=this.renderedCenter_,r=this.renderedResolution_,i=this.renderedRotation_,o=this.renderedProjection_,a=this.wrappedRenderedExtent_,l=this.getLayer(),h=[],u=n[0]*T,c=n[1]*T;h.push(this.getRenderTransform(s,r,i,T,u,c,0).slice());const y=l.getSource(),g=o.getExtent();if(y.getWrapX()&&o.canWrapX()&&!D(g,a)){let f=a[0];const m=N(g);let d=0,p;for(;f<g[0];)--d,p=m*d,h.push(this.getRenderTransform(s,r,i,T,u,c,p).slice()),f+=m;for(d=0,f=a[2];f>g[2];)++d,p=m*d,h.push(this.getRenderTransform(s,r,i,T,u,c,p).slice()),f-=m}this.hitDetectionImageData_=be(n,h,this.renderedFeatures_,l.getStyleFunction(),a,r,i)}t(Ne(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,n,s,r){if(!this.replayGroup_)return;const i=t.viewState.resolution,o=t.viewState.rotation,a=this.getLayer(),l={},h=function(y,g,f){const m=R(y),d=l[m];if(d){if(d!==!0&&f<d.distanceSq){if(f===0)return l[m]=!0,r.splice(r.lastIndexOf(d),1),s(y,a,g);d.geometry=g,d.distanceSq=f}}else{if(f===0)return l[m]=!0,s(y,a,g);r.push(l[m]={feature:y,layer:a,geometry:g,distanceSq:f,callback:s})}};let u;const c=[this.replayGroup_];return this.declutterExecutorGroup&&c.push(this.declutterExecutorGroup),c.some(y=>u=y.forEachFeatureAtCoordinate(e,i,o,n,h,y===this.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map(g=>g.value):null)),u}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),n=t.getSource();if(!n)return!1;const s=e.viewHints[b.ANIMATING],r=e.viewHints[b.INTERACTING],i=t.getUpdateWhileAnimating(),o=t.getUpdateWhileInteracting();if(this.ready&&!i&&s||!o&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const a=e.extent,l=e.viewState,h=l.projection,u=l.resolution,c=e.pixelRatio,y=t.getRevision(),g=t.getRenderBuffer();let f=t.getRenderOrder();f===void 0&&(f=Oe);const m=l.center.slice(),d=ge(a,g*u),p=d.slice(),I=[d.slice()],v=h.getExtent();if(n.getWrapX()&&h.canWrapX()&&!D(v,e.extent)){const _=N(v),C=Math.max(N(d)/2,_);d[0]=v[0]-C,d[2]=v[2]+C,me(m,h);const x=ye(I[0],h);x[0]<v[0]&&x[2]<v[2]?I.push([x[0]+_,x[1],x[2]+_,x[3]]):x[0]>v[0]&&x[2]>v[2]&&I.push([x[0]-_,x[1],x[2]-_,x[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==y&&this.renderedRenderOrder_==f&&D(this.wrappedRenderedExtent_,d))return xe(this.renderedExtent_,p)||(this.hitDetectionImageData_=null,this.renderedExtent_=p),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const w=new $(z(u,c),d,u,c);let A;this.getLayer().getDeclutter()&&(A=new $(z(u,c),d,u,c));const O=Ce();let H;if(O){for(let _=0,C=I.length;_<C;++_){const x=I[_],X=M(x,h);n.loadFeatures(X,Ee(u,h),O)}H=pe(O,h)}else for(let _=0,C=I.length;_<C;++_)n.loadFeatures(I[_],u,h);const te=Se(u,c);let U=!0;const ne=_=>{let C;const x=_.getStyleFunction()||t.getStyleFunction();if(x&&(C=x(_,u)),C){const X=this.renderFeature(_,te,C,w,H,A);U=U&&!X}},se=M(d,h),L=n.getFeaturesInExtent(se);f&&L.sort(f);for(let _=0,C=L.length;_<C;++_)ne(L[_]);this.renderedFeatures_=L,this.ready=U;const re=w.finish(),ie=new k(d,u,c,n.getOverlaps(),re,t.getRenderBuffer());return A&&(this.declutterExecutorGroup=new k(d,u,c,n.getOverlaps(),A.finish(),t.getRenderBuffer())),this.renderedResolution_=u,this.renderedRevision_=y,this.renderedRenderOrder_=f,this.renderedExtent_=p,this.wrappedRenderedExtent_=d,this.renderedCenter_=m,this.renderedProjection_=h,this.replayGroup_=ie,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,n,s,r,i){if(!n)return!1;let o=!1;if(Array.isArray(n))for(let a=0,l=n.length;a<l;++a)o=q(s,e,n[a],t,this.boundHandleStyleImageChange_,r,i)||o;else o=q(s,e,n,t,this.boundHandleStyleImageChange_,r,i);return o}}const Ve=Ke;class Be extends Ue{constructor(e){super(e)}createRenderer(){return new Ve(this)}}const ze=Be;class He{constructor(e){this.rbush_=new Xe(e),this.items_={}}insert(e,t){const n={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(n),this.items_[R(t)]=n}load(e,t){const n=new Array(t.length);for(let s=0,r=t.length;s<r;s++){const i=e[s],o=t[s],a={minX:i[0],minY:i[1],maxX:i[2],maxY:i[3],value:o};n[s]=a,this.items_[R(o)]=a}this.rbush_.load(n)}remove(e){const t=R(e),n=this.items_[t];return delete this.items_[t],this.rbush_.remove(n)!==null}update(e,t){const n=this.items_[R(t)],s=[n.minX,n.minY,n.maxX,n.maxY];ee(s,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(s){return s.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let n;for(let s=0,r=e.length;s<r;s++)if(n=t(e[s]),n)return n;return n}isEmpty(){return V(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return Re(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const Q=He,F={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function je(E,e){return[[-1/0,-1/0,1/0,1/0]]}function ke(E,e){return[E]}class G extends Te{constructor(e,t,n){super(e),this.feature=t,this.features=n}}class Me extends Ie{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Fe,this.format_=e.format,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(S(this.format_,7),this.loader_=J(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:je;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new Q:null,this.loadedExtentsRtree_=new Q,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,s;Array.isArray(e.features)?s=e.features:e.features&&(n=e.features,s=n.getArray()),!t&&n===void 0&&(n=new ve(s)),s!==void 0&&this.addFeaturesInternal(s),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=R(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const n=e.getGeometry();if(n){const s=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new G(F.ADDFEATURE,e))}setupChangeEvents_(e,t){this.featureChangeKeys_[e]=[K(t,Z.CHANGE,this.handleFeatureChange_,this),K(t,Ge.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(e,t){let n=!0;const s=t.getId();return s!==void 0&&(s.toString()in this.idIndex_?n=!1:this.idIndex_[s.toString()]=t),n&&(S(!(e in this.uidIndex_),30),this.uidIndex_[e]=t),n}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],n=[],s=[];for(let r=0,i=e.length;r<i;r++){const o=e[r],a=R(o);this.addToIndex_(a,o)&&n.push(o)}for(let r=0,i=n.length;r<i;r++){const o=n[r],a=R(o);this.setupChangeEvents_(a,o);const l=o.getGeometry();if(l){const h=l.getExtent();t.push(h),s.push(o)}else this.nullGeometryFeatures_[a]=o}if(this.featuresRtree_&&this.featuresRtree_.load(t,s),this.hasListener(F.ADDFEATURE))for(let r=0,i=n.length;r<i;r++)this.dispatchEvent(new G(F.ADDFEATURE,n[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(F.ADDFEATURE,function(n){t||(t=!0,e.push(n.feature),t=!1)}),this.addEventListener(F.REMOVEFEATURE,function(n){t||(t=!0,e.remove(n.feature),t=!1)}),e.addEventListener(P.ADD,n=>{t||(t=!0,this.addFeature(n.element),t=!1)}),e.addEventListener(P.REMOVE,n=>{t||(t=!0,this.removeFeature(n.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(W);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const n=s=>{this.removeFeatureInternal(s)};this.featuresRtree_.forEach(n);for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new G(F.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const n=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(n,function(s){if(s.getGeometry().intersectsCoordinate(e))return t(s)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(n){if(n.getGeometry().intersectsExtent(e)){const r=t(n);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),V(this.nullGeometryFeatures_)||Ae(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(n){t.push(n)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const s=we(e,t);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}else if(this.featuresCollection_)return this.featuresCollection_.getArray().slice(0);return[]}getClosestFeatureToCoordinate(e,t){const n=e[0],s=e[1];let r=null;const i=[NaN,NaN];let o=1/0;const a=[-1/0,-1/0,1/0,1/0];return t=t||De,this.featuresRtree_.forEachInExtent(a,function(l){if(t(l)){const h=l.getGeometry(),u=o;if(o=h.closestPointXY(n,s,i,o),o<u){r=l;const c=Math.sqrt(o);a[0]=n-c,a[1]=s-c,a[2]=n+c,a[3]=s+c}}}),r}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,n=R(t),s=t.getGeometry();if(!s)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[n]=t);else{const i=s.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(i,t)):this.featuresRtree_&&this.featuresRtree_.update(i,t)}const r=t.getId();if(r!==void 0){const i=r.toString();this.idIndex_[i]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[i]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[n]=t;this.changed(),this.dispatchEvent(new G(F.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:R(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&V(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,n){const s=this.loadedExtentsRtree_,r=this.strategy_(e,t,n);for(let i=0,o=r.length;i<o;++i){const a=r[i];s.forEachInExtent(a,function(h){return D(h.extent,a)})||(++this.loadingExtentsCount_,this.dispatchEvent(new G(F.FEATURESLOADSTART)),this.loader_.call(this,a,t,n,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new G(F.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new G(F.FEATURESLOADERROR))}),s.insert(a,{extent:a.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let n;t.forEachInExtent(e,function(s){if(ee(s.extent,e))return n=s,!0}),n&&t.remove(n)}removeFeature(e){if(!e)return;const t=R(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=R(e),n=this.featureChangeKeys_[t];if(!n)return;n.forEach(W),delete this.featureChangeKeys_[t];const s=e.getId();return s!==void 0&&delete this.idIndex_[s.toString()],delete this.uidIndex_[t],this.dispatchEvent(new G(F.REMOVEFEATURE,e)),e}removeFromIdIndex_(e){let t=!1;for(const n in this.idIndex_)if(this.idIndex_[n]===e){delete this.idIndex_[n],t=!0;break}return t}setLoader(e){this.loader_=e}setUrl(e){S(this.format_,7),this.url_=e,this.setLoader(J(e,this.format_))}}const qe=Me;export{$e as F,Q as R,ze as V,qe as a,ke as b,F as c};
