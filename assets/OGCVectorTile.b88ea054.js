import{q as lt,s as ct,t as dt,u as E,v as ye,w as ut,x as ht,R as Ge,y as Ce,z as ft,A as we,B as Le,D as ue,E as Oe,G as I,H as me,J as gt,K as xt,L as pt,n as Ye,i as b,N as We,O as $e,P as J,Q as ne,U as Ve,W as Tt,X as ke,Y as yt,Z as wt,_ as mt,$ as pe,a0 as Ft,a1 as Ct,a2 as Rt,a3 as Te,a4 as Ae,a5 as je,a6 as Et,a7 as vt,a as qe,a8 as le,a9 as _t,aa as St,ab as Pt,ac as Mt,ad as Dt,ae as It,af as Be,ag as Gt,g as Re,ah as Lt,ai as Ot,aj as Vt,ak as kt,al as At,am as jt,an as Bt,ao as zt,ap as Nt,aq as Ut,ar as Zt,as as Je,at as Xt,au as Ht,av as Kt,e as bt,d as Yt,aw as Wt,ax as $t,ay as qt,az as ze,m as Qe,aA as Jt,aB as Qt,aC as ei,aD as ti,aE as ii}from"./featureloader.09c78551.js";class ri extends lt{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=ct(),this.tmpTileRange_=new dt(0,0,0,0)}isDrawableTile(e){const i=this.getLayer(),r=e.getState(),n=i.getUseInterimTilesOnError();return r==E.LOADED||r==E.EMPTY||r==E.ERROR&&!n}getTile(e,i,r,n){const s=n.pixelRatio,o=n.viewState.projection,a=this.getLayer();let c=a.getSource().getTile(e,i,r,s,o);return c.getState()==E.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(c)||(c=c.getInterimTile()),c}getData(e){const i=this.frameState;if(!i)return null;const r=this.getLayer(),n=ye(i.pixelToCoordinateTransform,e.slice()),s=r.getExtent();if(s&&!ut(s,n))return null;const o=i.pixelRatio,a=i.viewState.projection,d=i.viewState,c=r.getRenderSource(),l=c.getTileGridForProjection(d.projection),u=c.getTilePixelRatio(i.pixelRatio);for(let x=l.getZForResolution(d.resolution);x>=l.getMinZoom();--x){const h=l.getTileCoordForCoordAndZ(n,x),g=c.getTile(x,h[1],h[2],o,a);if(!(g instanceof ht||g instanceof Ge)||g instanceof Ge&&g.getState()===E.EMPTY)return null;if(g.getState()!==E.LOADED)continue;const p=l.getOrigin(x),w=Ce(l.getTileSize(x)),F=l.getResolution(x),y=Math.floor(u*((n[0]-p[0])/F-h[1]*w[0])),T=Math.floor(u*((p[1]-n[1])/F-h[2]*w[1])),f=Math.round(u*c.getGutterForProjection(d.projection));return this.getImageData(g.getImage(),y+f,T+f)}return null}loadedTileCallback(e,i,r){return this.isDrawableTile(r)?super.loadedTileCallback(e,i,r):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,i){const r=e.layerStatesArray[e.layerIndex],n=e.viewState,s=n.projection,o=n.resolution,a=n.center,d=n.rotation,c=e.pixelRatio,l=this.getLayer(),u=l.getSource(),x=u.getRevision(),h=u.getTileGridForProjection(s),g=h.getZForResolution(o,u.zDirection),p=h.getResolution(g);let w=e.extent;const F=e.viewState.resolution,y=u.getTilePixelRatio(c),T=Math.round(ft(w)/F*c),f=Math.round(we(w)/F*c),C=r.extent&&Le(r.extent);C&&(w=ue(w,Le(r.extent)));const m=p*T/2/y,S=p*f/2/y,R=[a[0]-m,a[1]-S,a[0]+m,a[1]+S],v=h.getTileRangeForExtentAndZ(w,g),D={};D[g]={};const M=this.createLoadedTileFinder(u,s,D),G=this.tmpExtent,Z=this.tmpTileRange_;this.newTiles_=!1;const H=d?Oe(n.center,F,d,e.size):void 0;for(let X=v.minX;X<=v.maxX;++X)for(let O=v.minY;O<=v.maxY;++O){if(d&&!h.tileCoordIntersectsViewport([g,X,O],H))continue;const V=this.getTile(g,X,O,e);if(this.isDrawableTile(V)){const W=I(this);if(V.getState()==E.LOADED){D[g][V.tileCoord.toString()]=V;let $=V.inTransition(W);$&&r.opacity!==1&&(V.endTransition(W),$=!1),!this.newTiles_&&($||!this.renderedTiles.includes(V))&&(this.newTiles_=!0)}if(V.getAlpha(W,e.time)===1)continue}const fe=h.getTileCoordChildTileRange(V.tileCoord,Z,G);let te=!1;fe&&(te=M(g+1,fe)),te||h.forEachTileCoordParentTileRange(V.tileCoord,M,Z,G)}const j=p/o*c/y;me(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,d,-T/2,-f/2);const L=gt(this.pixelTransform);this.useContainer(i,L,this.getBackground(e));const P=this.context,k=P.canvas;xt(this.inversePixelTransform,this.pixelTransform),me(this.tempTransform,T/2,f/2,j,j,0,-T/2,-f/2),k.width!=T||k.height!=f?(k.width=T,k.height=f):this.containerReused||P.clearRect(0,0,T,f),C&&this.clipUnrotated(P,e,C),u.getInterpolate()||(P.imageSmoothingEnabled=!1),this.preRender(P,e),this.renderedTiles.length=0;let K=Object.keys(D).map(Number);K.sort(pt);let Y,he,B;r.opacity===1&&(!this.containerReused||u.getOpaque(e.viewState.projection))?K=K.reverse():(Y=[],he=[]);for(let X=K.length-1;X>=0;--X){const O=K[X],V=u.getTilePixelSize(O,c,s),te=h.getResolution(O)/p,W=V[0]*te*j,$=V[1]*te*j,ge=h.getTileCoordForCoordAndZ(Ye(R),O),ve=h.getTileCoordExtent(ge),oe=ye(this.tempTransform,[y*(ve[0]-R[0])/p,y*(R[3]-ve[3])/p]),rt=y*u.getGutterForProjection(s),_e=D[O];for(const nt in _e){const q=_e[nt],Se=q.tileCoord,Pe=ge[1]-Se[1],st=Math.round(oe[0]-(Pe-1)*W),Me=ge[2]-Se[2],ot=Math.round(oe[1]-(Me-1)*$),z=Math.round(oe[0]-Pe*W),N=Math.round(oe[1]-Me*$),ie=st-z,re=ot-N,De=g===O,Ie=De&&q.getAlpha(I(this),e.time)!==1;let xe=!1;if(!Ie)if(Y){B=[z,N,z+ie,N,z+ie,N+re,z,N+re];for(let ae=0,at=Y.length;ae<at;++ae)if(g!==O&&O<he[ae]){const A=Y[ae];b([z,N,z+ie,N+re],[A[0],A[3],A[4],A[7]])&&(xe||(P.save(),xe=!0),P.beginPath(),P.moveTo(B[0],B[1]),P.lineTo(B[2],B[3]),P.lineTo(B[4],B[5]),P.lineTo(B[6],B[7]),P.moveTo(A[6],A[7]),P.lineTo(A[4],A[5]),P.lineTo(A[2],A[3]),P.lineTo(A[0],A[1]),P.clip())}Y.push(B),he.push(O)}else P.clearRect(z,N,ie,re);this.drawTileImage(q,e,z,N,ie,re,rt,De),Y&&!Ie?(xe&&P.restore(),this.renderedTiles.unshift(q)):this.renderedTiles.push(q),this.updateUsedTiles(e.usedTiles,u,q)}}return this.renderedRevision=x,this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!We(this.renderedExtent_,R),this.renderedExtent_=R,this.renderedPixelRatio=c,this.renderedProjection=s,this.manageTilePyramid(e,u,h,c,s,w,g,l.getPreload()),this.scheduleExpireCache(e,u),this.postRender(P,e),r.extent&&P.restore(),P.imageSmoothingEnabled=!0,L!==k.style.transform&&(k.style.transform=L),this.container}drawTileImage(e,i,r,n,s,o,a,d){const c=this.getTileImage(e);if(!c)return;const l=I(this),u=i.layerStatesArray[i.layerIndex],x=u.opacity*(d?e.getAlpha(l,i.time):1),h=x!==this.context.globalAlpha;h&&(this.context.save(),this.context.globalAlpha=x),this.context.drawImage(c,a,a,c.width-2*a,c.height-2*a,r,n,s,o),h&&this.context.restore(),x!==u.opacity?i.animate=!0:d&&e.endTransition(l)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,i){if(i.canExpireCache()){const r=function(n,s,o){const a=I(n);a in o.usedTiles&&n.expireCache(o.viewState.projection,o.usedTiles[a])}.bind(null,i);e.postRenderFunctions.push(r)}}updateUsedTiles(e,i,r){const n=I(i);n in e||(e[n]={}),e[n][r.getKey()]=!0}manageTilePyramid(e,i,r,n,s,o,a,d,c){const l=I(i);l in e.wantedTiles||(e.wantedTiles[l]={});const u=e.wantedTiles[l],x=e.tileQueue,h=r.getMinZoom(),g=e.viewState.rotation,p=g?Oe(e.viewState.center,e.viewState.resolution,g,e.size):void 0;let w=0,F,y,T,f,C,m;for(m=h;m<=a;++m)for(y=r.getTileRangeForExtentAndZ(o,m,y),T=r.getResolution(m),f=y.minX;f<=y.maxX;++f)for(C=y.minY;C<=y.maxY;++C)g&&!r.tileCoordIntersectsViewport([m,f,C],p)||(a-m<=d?(++w,F=i.getTile(m,f,C,n,s),F.getState()==E.IDLE&&(u[F.getKey()]=!0,x.isKeyQueued(F.getKey())||x.enqueue([F,l,r.getTileCoordCenter(F.tileCoord),T])),c!==void 0&&c(F)):i.useTile(m,f,C,s));i.updateCacheSize(w,s)}}const ni=ri,si={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},oi={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class ai extends ni{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=$e()}prepareTile(e,i,r){let n;const s=e.getState();return(s===E.LOADED||s===E.ERROR)&&(this.updateExecutorGroup_(e,i,r),this.tileImageNeedsRender_(e)&&(n=!0)),n}getTile(e,i,r,n){const s=n.pixelRatio,o=n.viewState,a=o.resolution,d=o.projection,c=this.getLayer(),l=c.getSource().getTile(e,i,r,s,d),u=n.viewHints,x=!(u[J.ANIMATING]||u[J.INTERACTING]);return(x||!l.wantedResolution)&&(l.wantedResolution=a),this.prepareTile(l,s,d)&&(x||Date.now()-n.time<8)&&c.getRenderMode()!=="vector"&&this.renderTileImage_(l,n),super.getTile(e,i,r,n)}isDrawableTile(e){const i=this.getLayer();return super.isDrawableTile(e)&&(i.getRenderMode()==="vector"?I(i)in e.executorGroups:e.hasContext(i))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const i=this.getLayer().getRevision();return this.renderedLayerRevision_!==i&&(this.renderedLayerRevision_=i,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,i,r){const n=this.getLayer(),s=n.getRevision(),o=n.getRenderOrder()||null,a=e.wantedResolution,d=e.getReplayState(n);if(!d.dirty&&d.renderedResolution===a&&d.renderedRevision==s&&d.renderedRenderOrder==o)return;const c=n.getSource(),l=n.getDeclutter(),u=c.getTileGrid(),h=c.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),g=c.getSourceTiles(i,r,e),p=I(n);delete e.hitDetectionImageData[p],e.executorGroups[p]=[],l&&(e.declutterExecutorGroups[p]=[]),d.dirty=!1;for(let w=0,F=g.length;w<F;++w){const y=g[w];if(y.getState()!=E.LOADED)continue;const T=y.tileCoord,f=u.getTileCoordExtent(T),C=ue(h,f),m=ne(C,n.getRenderBuffer()*a,this.tmpExtent),S=We(f,C)?null:m,R=new Ve(0,m,a,i),v=l?new Ve(0,C,a,i):void 0,D=Tt(a,i),M=function(L){let P;const k=L.getStyleFunction()||n.getStyleFunction();if(k&&(P=k(L,a)),P){const K=this.renderFeature(L,D,P,R,v);d.dirty=d.dirty||K}},G=y.getFeatures();o&&o!==d.renderedRenderOrder&&G.sort(o);for(let L=0,P=G.length;L<P;++L){const k=G[L];(!S||b(S,k.getGeometry().getExtent()))&&M.call(this,k)}const Z=R.finish(),H=n.getRenderMode()!=="vector"&&l&&g.length===1?null:C,j=new ke(H,a,i,c.getOverlaps(),Z,n.getRenderBuffer());if(e.executorGroups[p].push(j),v){const L=new ke(null,a,i,c.getOverlaps(),v.finish(),n.getRenderBuffer());e.declutterExecutorGroups[p].push(L)}}d.renderedRevision=s,d.renderedRenderOrder=o,d.renderedResolution=a}forEachFeatureAtCoordinate(e,i,r,n,s){const o=i.viewState.resolution,a=i.viewState.rotation;r=r==null?0:r;const d=this.getLayer(),l=d.getSource().getTileGridForProjection(i.viewState.projection),u=yt([e]);ne(u,o*r,u);const x={},h=function(w,F,y){let T=w.getId();T===void 0&&(T=I(w));const f=x[T];if(f){if(f!==!0&&y<f.distanceSq){if(y===0)return x[T]=!0,s.splice(s.lastIndexOf(f),1),n(w,d,F);f.geometry=F,f.distanceSq=y}}else{if(y===0)return x[T]=!0,n(w,d,F);s.push(x[T]={feature:w,layer:d,geometry:F,distanceSq:y,callback:n})}},g=this.renderedTiles;let p;for(let w=0,F=g.length;!p&&w<F;++w){const y=g[w],T=l.getTileCoordExtent(y.wrappedTileCoord);if(!b(T,u))continue;const f=I(d),C=[y.executorGroups[f]],m=y.declutterExecutorGroups[f];m&&C.push(m),C.some(S=>{const R=S===m?i.declutterTree.all().map(v=>v.value):null;for(let v=0,D=S.length;v<D;++v)if(p=S[v].forEachFeatureAtCoordinate(e,o,a,r,h,R),p)return!0})}return p}getFeatures(e){return new Promise((i,r)=>{const n=this.getLayer(),s=I(n),o=n.getSource(),a=this.renderedProjection,d=a.getExtent(),c=this.renderedResolution,l=o.getTileGridForProjection(a),u=ye(this.renderedPixelToCoordinateTransform_,e.slice()),x=l.getTileCoordForCoordAndResolution(u,c);let h;for(let T=0,f=this.renderedTiles.length;T<f;++T)if(x.toString()===this.renderedTiles[T].tileCoord.toString()){if(h=this.renderedTiles[T],h.getState()===E.LOADED){const C=l.getTileCoordExtent(h.tileCoord);o.getWrapX()&&a.canWrapX()&&!wt(d,C)&&mt(u,a);break}h=void 0}if(!h||h.loadingSourceTiles>0){i([]);return}const g=l.getTileCoordExtent(h.wrappedTileCoord),p=Ye(g),w=[(u[0]-p[0])/c,(p[1]-u[1])/c],F=h.getSourceTiles().reduce(function(T,f){return T.concat(f.getFeatures())},[]);let y=h.hitDetectionImageData[s];if(!y){const T=Ce(l.getTileSize(l.getZForResolution(c,o.zDirection))),f=this.renderedRotation_,C=[this.getRenderTransform(l.getTileCoordCenter(h.wrappedTileCoord),c,0,pe,T[0]*pe,T[1]*pe,0)];y=Ft(T,C,F,n.getStyleFunction(),l.getTileCoordExtent(h.wrappedTileCoord),h.getReplayState(n).renderedResolution,f),h.hitDetectionImageData[s]=y}i(Ct(w,F,y))})}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e){const i=this.context,r=i.globalAlpha;i.globalAlpha=this.getLayer().getOpacity();const n=e.viewHints,s=!(n[J.ANIMATING]||n[J.INTERACTING]),o=this.renderedTiles;for(let a=0,d=o.length;a<d;++a){const c=o[a],l=c.declutterExecutorGroups[I(this.getLayer())];if(l)for(let u=l.length-1;u>=0;--u)l[u].execute(this.context,1,this.getTileRenderTransform(c,e),e.viewState.rotation,s,void 0,e.declutterTree)}i.globalAlpha=r}getTileRenderTransform(e,i){const r=i.pixelRatio,n=i.viewState,s=n.center,o=n.resolution,a=n.rotation,d=i.size,c=Math.round(d[0]*r),l=Math.round(d[1]*r),x=this.getLayer().getSource().getTileGridForProjection(i.viewState.projection),h=e.tileCoord,g=x.getTileCoordExtent(e.wrappedTileCoord),p=x.getTileCoordExtent(h,this.tmpExtent)[0]-g[0];return Rt(Te(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(s,o,a,r,c,l,p))}postRender(e,i){const r=i.viewHints,n=!(r[J.ANIMATING]||r[J.INTERACTING]);this.renderedPixelToCoordinateTransform_=i.pixelToCoordinateTransform.slice(),this.renderedRotation_=i.viewState.rotation;const s=this.getLayer(),o=s.getRenderMode(),a=e.globalAlpha;e.globalAlpha=s.getOpacity();const d=oi[o],c=i.viewState,l=c.rotation,u=s.getSource(),h=u.getTileGridForProjection(c.projection).getZForResolution(c.resolution,u.zDirection),g=this.renderedTiles,p=[],w=[];let F=!0;for(let y=g.length-1;y>=0;--y){const T=g[y];F=F&&!T.getReplayState(s).dirty;const f=T.executorGroups[I(s)].filter(v=>v.hasExecutors(d));if(f.length===0)continue;const C=this.getTileRenderTransform(T,i),m=T.tileCoord[0];let S=!1;const R=f[0].getClipCoords(C);if(R){for(let v=0,D=p.length;v<D;++v)if(h!==m&&m<w[v]){const M=p[v];b([R[0],R[3],R[4],R[7]],[M[0],M[3],M[4],M[7]])&&(S||(e.save(),S=!0),e.beginPath(),e.moveTo(R[0],R[1]),e.lineTo(R[2],R[3]),e.lineTo(R[4],R[5]),e.lineTo(R[6],R[7]),e.moveTo(M[6],M[7]),e.lineTo(M[4],M[5]),e.lineTo(M[2],M[3]),e.lineTo(M[0],M[1]),e.clip())}p.push(R),w.push(m)}for(let v=0,D=f.length;v<D;++v)f[v].execute(e,1,C,l,n,d);S&&e.restore()}e.globalAlpha=a,this.ready=F,super.postRender(e,i)}renderFeature(e,i,r,n,s){if(!r)return!1;let o=!1;if(Array.isArray(r))for(let a=0,d=r.length;a<d;++a)o=Ae(n,e,r[a],i,this.boundHandleStyleImageChange_,void 0,s)||o;else o=Ae(n,e,r,i,this.boundHandleStyleImageChange_,void 0,s);return o}tileImageNeedsRender_(e){const i=this.getLayer();if(i.getRenderMode()==="vector")return!1;const r=e.getReplayState(i),n=i.getRevision(),s=e.wantedResolution;return r.renderedTileResolution!==s||r.renderedTileRevision!==n}renderTileImage_(e,i){const r=this.getLayer(),n=e.getReplayState(r),s=r.getRevision(),o=e.executorGroups[I(r)];n.renderedTileRevision=s;const a=e.wrappedTileCoord,d=a[0],c=r.getSource();let l=i.pixelRatio;const x=i.viewState.projection,h=c.getTileGridForProjection(x),g=h.getResolution(e.tileCoord[0]),p=i.pixelRatio/e.wantedResolution*g,w=h.getResolution(d),F=e.getContext(r);l=Math.round(Math.max(l,p/l));const y=c.getTilePixelSize(d,l,x);F.canvas.width=y[0],F.canvas.height=y[1];const T=l/p;if(T!==1){const S=je(this.tmpTransform_);Te(S,T,T),F.setTransform.apply(F,S)}const f=h.getTileCoordExtent(a,this.tmpExtent),C=p/w,m=je(this.tmpTransform_);Te(m,C,-C),Et(m,-f[0],-f[3]);for(let S=0,R=o.length;S<R;++S)o[S].execute(F,T,m,0,!0,si[r.getRenderMode()]);n.renderedTileResolution=e.wantedResolution}}const li=ai;class ci extends vt{constructor(e){e=e||{};const i=Object.assign({},e);delete i.preload,delete i.useInterimTilesOnError,super(i),this.on,this.once,this.un;const r=e.renderMode||"hybrid";qe(r=="hybrid"||r=="vector",28),this.renderMode_=r,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new li(this)}getFeatures(e){return super.getFeatures(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(le.PRELOAD)}getUseInterimTilesOnError(){return this.get(le.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(le.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(le.USE_INTERIM_TILES_ON_ERROR,e)}}const qi=ci,Ne=$e();class se{constructor(e,i,r,n,s){this.styleFunction,this.extent_,this.id_=s,this.type_=e,this.flatCoordinates_=i,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=r,this.properties_=n}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?_t(this.flatCoordinates_):St(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=Pt(this.getExtent());this.flatInteriorPoints_=Mt(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=Dt(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=It(this.flatCoordinates_,0,this.ends_,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Be(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let i=0;const r=this.ends_;for(let n=0,s=r.length;n<s;++n){const o=r[n],a=Be(e,i,o,2,.5);Gt(this.flatMidpoints_,a),i=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,i){return this}getProperties(){return this.properties_}getStride(){return 2}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=Re(e);const i=e.getExtent(),r=e.getWorldExtent();if(i&&r){const n=we(r)/we(i);me(Ne,r[0],r[3],n,-n,0,0,0),Lt(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Ne,this.flatCoordinates_)}}getEnds(){return this.ends_}}se.prototype.getEndss=se.prototype.getEnds;se.prototype.getFlatCoordinates=se.prototype.getOrientedFlatCoordinates;const Ue=se;var Ee={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ee.read=function(t,e,i,r,n){var s,o,a=n*8-r-1,d=(1<<a)-1,c=d>>1,l=-7,u=i?n-1:0,x=i?-1:1,h=t[e+u];for(u+=x,s=h&(1<<-l)-1,h>>=-l,l+=a;l>0;s=s*256+t[e+u],u+=x,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=o*256+t[e+u],u+=x,l-=8);if(s===0)s=1-c;else{if(s===d)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-c}return(h?-1:1)*o*Math.pow(2,s-r)};Ee.write=function(t,e,i,r,n,s){var o,a,d,c=s*8-n-1,l=(1<<c)-1,u=l>>1,x=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,g=r?1:-1,p=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=l):(o=Math.floor(Math.log(e)/Math.LN2),e*(d=Math.pow(2,-o))<1&&(o--,d*=2),o+u>=1?e+=x/d:e+=x*Math.pow(2,1-u),e*d>=2&&(o++,d/=2),o+u>=l?(a=0,o=l):o+u>=1?(a=(e*d-1)*Math.pow(2,n),o=o+u):(a=e*Math.pow(2,u-1)*Math.pow(2,n),o=0));n>=8;t[i+h]=a&255,h+=g,a/=256,n-=8);for(o=o<<n|a,c+=n;c>0;t[i+h]=o&255,h+=g,o/=256,c-=8);t[i+h-g]|=p*128};var di=_,ce=Ee;function _(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}_.Varint=0;_.Fixed64=1;_.Bytes=2;_.Fixed32=5;var Fe=(1<<16)*(1<<16),Ze=1/Fe,ui=12,et=typeof TextDecoder>"u"?null:new TextDecoder("utf8");_.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,s=this.pos;this.type=r&7,t(n,e,this),this.pos===s&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=de(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=He(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=de(this.buf,this.pos)+de(this.buf,this.pos+4)*Fe;return this.pos+=8,t},readSFixed64:function(){var t=de(this.buf,this.pos)+He(this.buf,this.pos+4)*Fe;return this.pos+=8,t},readFloat:function(){var t=ce.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ce.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,i,r;return r=e[this.pos++],i=r&127,r<128||(r=e[this.pos++],i|=(r&127)<<7,r<128)||(r=e[this.pos++],i|=(r&127)<<14,r<128)||(r=e[this.pos++],i|=(r&127)<<21,r<128)?i:(r=e[this.pos],i|=(r&15)<<28,hi(i,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=ui&&et?_i(this.buf,e,t):vi(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==_.Bytes)return t.push(this.readVarint(e));var i=U(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==_.Bytes)return t.push(this.readSVarint());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==_.Bytes)return t.push(this.readBoolean());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==_.Bytes)return t.push(this.readFloat());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==_.Bytes)return t.push(this.readDouble());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==_.Bytes)return t.push(this.readFixed32());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==_.Bytes)return t.push(this.readSFixed32());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==_.Bytes)return t.push(this.readFixed64());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==_.Bytes)return t.push(this.readSFixed64());var e=U(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===_.Varint)for(;this.buf[this.pos++]>127;);else if(e===_.Bytes)this.pos=this.readVarint()+this.pos;else if(e===_.Fixed32)this.pos+=4;else if(e===_.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),ee(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),ee(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),ee(this.buf,t&-1,this.pos),ee(this.buf,Math.floor(t*Ze),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),ee(this.buf,t&-1,this.pos),ee(this.buf,Math.floor(t*Ze),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){fi(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=Si(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Xe(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),ce.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ce.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&Xe(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,_.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,pi,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Ti,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,mi,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,yi,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,wi,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Fi,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Ci,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Ri,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Ei,e)},writeBytesField:function(t,e){this.writeTag(t,_.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,_.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,_.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,_.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,_.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,_.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,_.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,_.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,_.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,_.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};function hi(t,e,i){var r=i.buf,n,s;if(s=r[i.pos++],n=(s&112)>>4,s<128||(s=r[i.pos++],n|=(s&127)<<3,s<128)||(s=r[i.pos++],n|=(s&127)<<10,s<128)||(s=r[i.pos++],n|=(s&127)<<17,s<128)||(s=r[i.pos++],n|=(s&127)<<24,s<128)||(s=r[i.pos++],n|=(s&1)<<31,s<128))return Q(t,n,e);throw new Error("Expected varint not more than 10 bytes")}function U(t){return t.type===_.Bytes?t.readVarint()+t.pos:t.pos+1}function Q(t,e,i){return i?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function fi(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(i=~(-t%4294967296),r=~(-t/4294967296),i^4294967295?i=i+1|0:(i=0,r=r+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),gi(i,r,e),xi(r,e)}function gi(t,e,i){i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos]=t&127}function xi(t,e){var i=(t&7)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function Xe(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function pi(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Ti(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function yi(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function wi(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function mi(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Fi(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Ci(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Ri(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Ei(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function de(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function ee(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function He(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function vi(t,e,i){for(var r="",n=e;n<i;){var s=t[n],o=null,a=s>239?4:s>223?3:s>191?2:1;if(n+a>i)break;var d,c,l;a===1?s<128&&(o=s):a===2?(d=t[n+1],(d&192)===128&&(o=(s&31)<<6|d&63,o<=127&&(o=null))):a===3?(d=t[n+1],c=t[n+2],(d&192)===128&&(c&192)===128&&(o=(s&15)<<12|(d&63)<<6|c&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(d=t[n+1],c=t[n+2],l=t[n+3],(d&192)===128&&(c&192)===128&&(l&192)===128&&(o=(s&15)<<18|(d&63)<<12|(c&63)<<6|l&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),r+=String.fromCharCode(o),n+=a}return r}function _i(t,e,i){return et.decode(t.subarray(e,i))}function Si(t,e,i){for(var r=0,n,s;r<e.length;r++){if(n=e.charCodeAt(r),n>55295&&n<57344)if(s)if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||r+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):s=n;continue}else s&&(t[i++]=239,t[i++]=191,t[i++]=189,s=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=n&63|128)}return i}class Pi extends Ot{constructor(e){super(),e=e||{},this.dataProjection=new Vt({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:Ue,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,i,r,n){e.pos=i.geometry;const s=e.readVarint()+e.pos;let o=1,a=0,d=0,c=0,l=0,u=0;for(;e.pos<s;){if(!a){const x=e.readVarint();o=x&7,a=x>>3}a--,o===1||o===2?(d+=e.readSVarint(),c+=e.readSVarint(),o===1&&l>u&&(n.push(l),u=l),r.push(d,c),l+=2):o===7?l>u&&(r.push(r[u],r[u+1]),l+=2):qe(!1,59)}l>u&&(n.push(l),u=l)}createFeature_(e,i,r){const n=i.type;if(n===0)return null;let s;const o=i.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=i.id,o[this.layerName_]=i.layer.name;const d=[],c=[];this.readRawGeometry_(e,i,d,c);const l=Li(n,c.length);if(this.featureClass_===Ue)s=new this.featureClass_(l,d,c,o,a),s.transform(r.dataProjection);else{let u;if(l=="Polygon"){const g=kt(d,c);u=g.length>1?new At(d,"XY",g):new jt(d,"XY",c)}else u=l==="Point"?new Bt(d,"XY"):l==="LineString"?new zt(d,"XY"):l==="MultiPoint"?new Nt(d,"XY"):l==="MultiLineString"?new Ut(d,"XY",c):null;const x=this.featureClass_;s=new x,this.geometryName_&&s.setGeometryName(this.geometryName_);const h=Zt(u,!1,r);s.setGeometry(h),a!==void 0&&s.setId(a),s.setProperties(o,!0)}return s}getType(){return"arraybuffer"}readFeatures(e,i){const r=this.layers_;i=this.adaptOptions(i);const n=Re(i.dataProjection);n.setWorldExtent(i.extent),i.dataProjection=n;const s=new di(e),o=s.readFields(Mi,{}),a=[];for(const d in o){if(r&&!r.includes(d))continue;const c=o[d],l=c?[0,0,c.extent,c.extent]:null;n.setExtent(l);for(let u=0,x=c.length;u<x;++u){const h=Gi(s,c,u),g=this.createFeature_(s,h,i);g!==null&&a.push(g)}}return a}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function Mi(t,e,i){if(t===3){const r={keys:[],values:[],features:[]},n=i.readVarint()+i.pos;i.readFields(Di,r,n),r.length=r.features.length,r.length&&(e[r.name]=r)}}function Di(t,e,i){if(t===15)e.version=i.readVarint();else if(t===1)e.name=i.readString();else if(t===5)e.extent=i.readVarint();else if(t===2)e.features.push(i.pos);else if(t===3)e.keys.push(i.readString());else if(t===4){let r=null;const n=i.readVarint()+i.pos;for(;i.pos<n;)t=i.readVarint()>>3,r=t===1?i.readString():t===2?i.readFloat():t===3?i.readDouble():t===4?i.readVarint64():t===5?i.readVarint():t===6?i.readSVarint():t===7?i.readBoolean():null;e.values.push(r)}}function Ii(t,e,i){if(t==1)e.id=i.readVarint();else if(t==2){const r=i.readVarint()+i.pos;for(;i.pos<r;){const n=e.layer.keys[i.readVarint()],s=e.layer.values[i.readVarint()];e.properties[n]=s}}else t==3?e.type=i.readVarint():t==4&&(e.geometry=i.pos)}function Gi(t,e,i){t.pos=e.features[i];const r=t.readVarint()+t.pos,n={layer:e,type:0,properties:{}};return t.readFields(Ii,n,r),n}function Li(t,e){let i;return t===1?i=e===1?"Point":"MultiPoint":t===2?i=e===1?"LineString":"MultiLineString":t===3&&(i="Polygon"),i}const Ji=Pi;function Qi(t,e,i,r){const n=document.createElement("script"),s="olc_"+I(e);function o(){delete window[s],n.parentNode.removeChild(n)}n.async=!0,n.src=t+(t.includes("?")?"&":"?")+(r||"callback")+"="+s;const a=setTimeout(function(){o(),i&&i()},1e4);window[s]=function(d){clearTimeout(a),o(),e(d)},document.head.appendChild(n)}class Oi extends Error{constructor(e){const i="Unexpected response status: "+e.status;super(i),this.name="ResponseError",this.response=e}}class Vi extends Error{constructor(e){super("Failed to issue request"),this.name="ClientError",this.client=e}}function tt(t){return new Promise(function(e,i){function r(o){const a=o.target;if(!a.status||a.status>=200&&a.status<300){let d;try{d=JSON.parse(a.responseText)}catch(c){const l="Error parsing response text as JSON: "+c.message;i(new Error(l));return}e(d);return}i(new Oi(a))}function n(o){i(new Vi(o.target))}const s=new XMLHttpRequest;s.addEventListener("load",r),s.addEventListener("error",n),s.open("GET",t),s.setRequestHeader("Accept","application/json"),s.send()})}function it(t,e){return e.includes("://")?e:new URL(e,t).href}class ki extends Je{constructor(e,i,r,n,s,o){super(e,i,o),this.extent=null,this.format_=n,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=s,this.url_=r,this.key=r}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==E.IDLE&&(this.setState(E.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,i){this.setFeatures(e)}onError(){this.setState(E.ERROR)}setFeatures(e){this.features_=e,this.setState(E.LOADED)}setLoader(e){this.loader_=e}}const Ai=ki,Ke=[];class ji extends Je{constructor(e,i,r,n){super(e,i,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=n.bind(void 0,this),this.wrappedTileCoord=r}getContext(e){const i=I(e);return i in this.context_||(this.context_[i]=Xt(1,1,Ke)),this.context_[i]}hasContext(e){return I(e)in this.context_}getImage(e){return this.hasContext(e)?this.getContext(e).canvas:null}getReplayState(e){const i=I(e);return i in this.replayState_||(this.replayState_[i]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[i]}load(){this.getSourceTiles()}release(){for(const e in this.context_){const i=this.context_[e];Ht(i),Ke.push(i.canvas),delete this.context_[e]}super.release()}}const Bi=ji;class zi extends Kt{constructor(e){const i=e.projection||"EPSG:3857",r=e.extent||bt(i),n=e.tileGrid||Yt({extent:r,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:i,state:e.state,tileGrid:n,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Ui,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.sourceTileCache=new Wt(this.tileCache.highWaterMark),this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:Ai,this.tileGrids_={}}getFeaturesInExtent(e){const i=[],r=this.tileCache;if(r.getCount()===0)return i;const n=$t(r.peekFirstKey())[0],s=this.tileGrid;return r.forEach(function(o){if(o.tileCoord[0]!==n||o.getState()!==E.LOADED)return;const a=o.getSourceTiles();for(let d=0,c=a.length;d<c;++d){const l=a[d],u=l.tileCoord;if(b(e,s.getTileCoordExtent(u))){const x=l.getFeatures();if(x)for(let h=0,g=x.length;h<g;++h){const p=x[h],w=p.getGeometry();b(e,w.getExtent())&&i.push(p)}}}}),i}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(e,i){const r=this.getTileCacheForProjection(e),n=Object.keys(i).reduce((s,o)=>{const a=qt(o),d=r.peek(a);if(d){const c=d.sourceTiles;for(let l=0,u=c.length;l<u;++l)s[c[l].getKey()]=!0}return s},{});super.expireCache(e,i),this.sourceTileCache.expireCache(n)}getSourceTiles(e,i,r){if(r.getState()===E.IDLE){r.setState(E.LOADING);const n=r.wrappedTileCoord,s=this.getTileGridForProjection(i),o=s.getTileCoordExtent(n),a=n[0],d=s.getResolution(a);ne(o,-d,o);const c=this.tileGrid,l=c.getExtent();l&&ue(o,l,o);const u=c.getZForResolution(d,this.zDirection);c.forEachTileCoord(o,u,x=>{const h=this.tileUrlFunction(x,e,i),g=this.sourceTileCache.containsKey(h)?this.sourceTileCache.get(h):new this.tileClass(x,h?E.IDLE:E.EMPTY,h,this.format_,this.tileLoadFunction);r.sourceTiles.push(g);const p=g.getState();if(p<E.LOADED){const w=F=>{this.handleTileChange(F);const y=g.getState();if(y===E.LOADED||y===E.ERROR){const T=g.getKey();T in r.errorTileKeys?g.getState()===E.LOADED&&delete r.errorTileKeys[T]:r.loadingSourceTiles--,y===E.ERROR?r.errorTileKeys[T]=!0:g.removeEventListener(ze.CHANGE,w),r.loadingSourceTiles===0&&r.setState(Qt(r.errorTileKeys)?E.LOADED:E.ERROR)}};g.addEventListener(ze.CHANGE,w),r.loadingSourceTiles++}p===E.IDLE&&(g.extent=c.getTileCoordExtent(x),g.projection=i,g.resolution=c.getResolution(x[0]),this.sourceTileCache.set(h,g),g.load())}),r.loadingSourceTiles||r.setState(r.sourceTiles.some(x=>x.getState()===E.ERROR)?E.ERROR:E.LOADED)}return r.sourceTiles}getTile(e,i,r,n,s){const o=ei(e,i,r),a=this.getKey();let d;if(this.tileCache.containsKey(o)&&(d=this.tileCache.get(o),d.key===a))return d;const c=[e,i,r];let l=this.getTileCoordForTileUrlFunction(c,s);const u=this.getTileGrid().getExtent(),x=this.getTileGridForProjection(s);if(l&&u){const p=x.getTileCoordExtent(l);ne(p,-x.getResolution(e),p),b(u,p)||(l=null)}let h=!0;if(l!==null){const p=this.tileGrid,w=x.getResolution(e),F=p.getZForResolution(w,1),y=x.getTileCoordExtent(l);ne(y,-w,y),p.forEachTileCoord(y,F,T=>{h=h&&!this.tileUrlFunction(T,n,s)})}const g=new Bi(c,h?E.EMPTY:E.IDLE,l,this.getSourceTiles.bind(this,n,s));return g.key=a,d?(g.interimTile=d,g.refreshInterimChain(),this.tileCache.replace(o,g)):this.tileCache.set(o,g),g}getTileGridForProjection(e){const i=e.getCode();let r=this.tileGrids_[i];if(!r){const n=this.tileGrid,s=n.getResolutions().slice(),o=s.map(function(c,l){return n.getOrigin(l)}),a=s.map(function(c,l){return n.getTileSize(l)}),d=ti+1;for(let c=s.length;c<d;++c)s.push(s[c-1]/2),o.push(o[c-1]),a.push(a[c-1]);r=new Qe({extent:n.getExtent(),origins:o,resolutions:s,tileSizes:a}),this.tileGrids_[i]=r}return r}getTilePixelRatio(e){return e}getTilePixelSize(e,i,r){const n=this.getTileGridForProjection(r),s=Ce(n.getTileSize(e),this.tmpSize);return[Math.round(s[0]*i),Math.round(s[1]*i)]}updateCacheSize(e,i){super.updateCacheSize(e*2,i),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(i).highWaterMark}}const Ni=zi;function Ui(t,e){t.setLoader(function(i,r,n){Jt(e,t.getFormat(),i,r,n,t.onLoad.bind(t),t.onError.bind(t))})}const Zi={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},Xi={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function Hi(t,e){let i,r;for(let n=0;n<t.length;++n){const s=t[n];if(s.rel==="item"){if(s.type===e){i=s.href;break}(Zi[s.type]||!r&&s.type.startsWith("image/"))&&(r=s.href)}}if(!i)if(r)i=r;else throw new Error('Could not find "item" link');return i}function Ki(t,e,i){let r,n;const s={};for(let o=0;o<t.length;++o){const a=t[o];if(s[a.type]=a.href,a.rel==="item"){if(a.type===e){r=a.href;break}Xi[a.type]&&(n=a.href)}}if(!r&&i)for(let o=0;o<i.length;++o){const a=i[o];if(s[a]){r=s[a];break}}if(!r)if(n)r=n;else throw new Error('Could not find "item" link');return r}function be(t,e,i,r){let n=t.projection;if(!n&&(n=Re(e.crs),!n))throw new Error(`Unsupported CRS: ${e.crs}`);const s=n.getAxisOrientation().substr(0,2)!=="en",o=e.tileMatrices,a={};for(let f=0;f<o.length;++f){const C=o[f];a[C.id]=C}const d={},c=[];if(r)for(let f=0;f<r.length;++f){const C=r[f],m=C.tileMatrix;c.push(m),d[m]=C}else for(let f=0;f<o.length;++f){const C=o[f].id;c.push(C)}const l=c.length,u=new Array(l),x=new Array(l),h=new Array(l),g=new Array(l),p=[-1/0,-1/0,1/0,1/0];for(let f=0;f<l;++f){const C=c[f],m=a[C],S=m.pointOfOrigin;s?u[f]=[S[1],S[0]]:u[f]=S,x[f]=m.cellSize,h[f]=[m.matrixWidth,m.matrixHeight],g[f]=[m.tileWidth,m.tileHeight];const R=d[C];if(R){const v=m.cellSize*m.tileWidth,D=u[f][0]+R.minTileCol*v,M=u[f][0]+(R.maxTileCol+1)*v,G=m.cellSize*m.tileHeight,Z=m.cornerOfOrigin==="bottomLeft";let H,j;Z?(H=u[f][1]+R.minTileRow*G,j=u[f][1]+(R.maxTileRow+1)*G):(H=u[f][1]-(R.maxTileRow+1)*G,j=u[f][1]-R.minTileRow*G),ue(p,[D,H,M,j],p)}}const w=new Qe({origins:u,resolutions:x,sizes:h,tileSizes:g,extent:r?p:void 0}),F=t.context,y=t.url;function T(f,C,m){if(!f)return;const S=c[f[0]],R=a[S],v=R.cornerOfOrigin==="bottomLeft",D={tileMatrix:S,tileCol:f[1],tileRow:v?-f[2]-1:f[2]};if(r){const G=d[R.id];if(D.tileCol<G.minTileCol||D.tileCol>G.maxTileCol||D.tileRow<G.minTileRow||D.tileRow>G.maxTileRow)return}Object.assign(D,F);const M=i.replace(/\{(\w+?)\}/g,function(G,Z){return D[Z]});return it(y,M)}return{grid:w,urlTemplate:i,urlFunction:T}}function bi(t,e){const i=e.tileMatrixSetLimits;let r;if(e.dataType==="map")r=Hi(e.links,t.mediaType);else if(e.dataType==="vector")r=Ki(e.links,t.mediaType,t.supportedMediaTypes);else throw new Error('Expected tileset data type to be "map" or "vector"');if(e.tileMatrixSet)return be(t,e.tileMatrixSet,r,i);const n=e.links.find(a=>a.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!n)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const s=n.href,o=it(t.url,s);return tt(o).then(function(a){return be(t,a,r,i)})}function Yi(t){return tt(t.url).then(function(e){return bi(t,e)})}class Wi extends Ni{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"});const i={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null};Yi(i).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){ii(e),this.setState("error")}}const er=Wi;export{Ji as M,er as O,Ue as R,qi as V,Ni as a,Ui as d,Qi as j};
