import{aF as fe,aG as U,aH as K,az as W,a as S,aI as me,aJ as ye,aK as _e,aL as pe,ab as Ee,ai as xe,aM as v,g as A,aB as X,ar as se,an as Ce,ao as Fe,aq as Ge,ap as Re,al as Ie,am as Te,av as ve,x as we,j as O,G as x,aN as Pe,aw as Oe,u as Y,aO as je,R as Ae,aC as be,q as Se,s as $,P as L,z as D,at as Ne,aP as q,au as Le,aQ as De,K as Me,J as Ue,B as Ke,i as Xe,Z as b,v as ke,$ as j,a0 as We,a1 as He,Q as Ye,_ as Ve,aR as Je,aS as Be,U as z,aT as Z,W as $e,X as Q,a4 as ee,aU as qe,aV as ze,a7 as Ze,aW as Qe,N as oe,aX as et,aY as tt,aZ as rt,a_ as te,a$ as it,b0 as nt,b1 as re,ag as st,b2 as ot,b3 as at,b4 as lt}from"./featureloader.09c78551.js";class B extends fe{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new B(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const r=this.getStyle();return r&&e.setStyle(r),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(U(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=K(e,W.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?ht(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function ht(s){if(typeof s=="function")return s;let e;return Array.isArray(s)?e=s:(S(typeof s.getZIndex=="function",41),e=[s]),function(){return e}}const ct=B;class k extends me{constructor(e){super(),this.geometries_=e||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(U),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(!!this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)this.changeEventsKeys_.push(K(this.geometries_[e],W.CHANGE,this.changed,this))}clone(){const e=new k(null);return e.setGeometries(this.geometries_),e.applyProperties(this),e}closestPointXY(e,t,r,i){if(i<ye(this.getExtent(),e,t))return i;const n=this.geometries_;for(let o=0,a=n.length;o<a;++o)i=n[o].closestPointXY(e,t,r,i);return i}containsXY(e,t){const r=this.geometries_;for(let i=0,n=r.length;i<n;++i)if(r[i].containsXY(e,t))return!0;return!1}computeExtent(e){_e(e);const t=this.geometries_;for(let r=0,i=t.length;r<i;++r)pe(e,t[r].getExtent());return e}getGeometries(){return ie(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let r=0,i=t.length;r<i;++r)t[r].getType()===this.getType()?e=e.concat(t[r].getGeometriesArrayRecursive()):e.push(t[r]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],r=this.geometries_;let i=!1;for(let n=0,o=r.length;n<o;++n){const a=r[n],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(i=!0)}if(i){const n=new k(null);return n.setGeometriesArray(t),n}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let r=0,i=t.length;r<i;++r)if(t[r].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const r=this.geometries_;for(let i=0,n=r.length;i<n;++i)r[i].rotate(e,t);this.changed()}scale(e,t,r){r||(r=Ee(this.getExtent()));const i=this.geometries_;for(let n=0,o=i.length;n<o;++n)i[n].scale(e,t,r);this.changed()}setGeometries(e){this.setGeometriesArray(ie(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let r=0,i=t.length;r<i;++r)t[r].applyTransform(e);this.changed()}translate(e,t){const r=this.geometries_;for(let i=0,n=r.length;i<n;++i)r[i].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function ie(s){const e=[];for(let t=0,r=s.length;t<r;++t)e.push(s[t].clone());return e}const ut=k;class dt extends xe{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(M(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(M(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return v()}readFeaturesFromObject(e,t){return v()}readGeometry(e,t){return this.readGeometryFromObject(M(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return v()}readProjection(e){return this.readProjectionFromObject(M(e))}readProjectionFromObject(e){return v()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return v()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return v()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return v()}}function M(s){if(typeof s=="string"){const e=JSON.parse(s);return e||null}else if(s!==null)return s;return null}const gt=dt;class ft extends gt{constructor(e){e=e||{},super(),this.dataProjection=A(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=A(e.featureProjection)),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let r=null;e.type==="Feature"?r=e:r={type:"Feature",geometry:e,properties:null};const i=V(r.geometry,t),n=new ct;return this.geometryName_?n.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in r!==void 0&&n.setGeometryName(r.geometry_name),n.setGeometry(i),"id"in r&&n.setId(r.id),r.properties&&n.setProperties(r.properties,!0),n}readFeaturesFromObject(e,t){const r=e;let i=null;if(r.type==="FeatureCollection"){const n=e;i=[];const o=n.features;for(let a=0,l=o.length;a<l;++a)i.push(this.readFeatureFromObject(o[a],t))}else i=[this.readFeatureFromObject(e,t)];return i}readGeometryFromObject(e,t){return V(e,t)}readProjectionFromObject(e){const t=e.crs;let r;return t?t.type=="name"?r=A(t.properties.name):t.type==="EPSG"?r=A("EPSG:"+t.properties.code):S(!1,36):r=this.dataProjection,r}writeFeatureObject(e,t){t=this.adaptOptions(t);const r={type:"Feature",geometry:null,properties:null},i=e.getId();if(i!==void 0&&(r.id=i),!e.hasProperties())return r;const n=e.getProperties(),o=e.getGeometry();return o&&(r.geometry=J(o,t),delete n[e.getGeometryName()]),X(n)||(r.properties=n),r}writeFeaturesObject(e,t){t=this.adaptOptions(t);const r=[];for(let i=0,n=e.length;i<n;++i)r.push(this.writeFeatureObject(e[i],t));return{type:"FeatureCollection",features:r}}writeGeometryObject(e,t){return J(e,this.adaptOptions(t))}}function V(s,e){if(!s)return null;let t;switch(s.type){case"Point":{t=yt(s);break}case"LineString":{t=_t(s);break}case"Polygon":{t=Ct(s);break}case"MultiPoint":{t=Et(s);break}case"MultiLineString":{t=pt(s);break}case"MultiPolygon":{t=xt(s);break}case"GeometryCollection":{t=mt(s);break}default:throw new Error("Unsupported GeoJSON type: "+s.type)}return se(t,!1,e)}function mt(s,e){const t=s.geometries.map(function(r){return V(r,e)});return new ut(t)}function yt(s){return new Ce(s.coordinates)}function _t(s){return new Fe(s.coordinates)}function pt(s){return new Ge(s.coordinates)}function Et(s){return new Re(s.coordinates)}function xt(s){return new Ie(s.coordinates)}function Ct(s){return new Te(s.coordinates)}function J(s,e){s=se(s,!0,e);const t=s.getType();let r;switch(t){case"Point":{r=vt(s);break}case"LineString":{r=Gt(s);break}case"Polygon":{r=wt(s,e);break}case"MultiPoint":{r=It(s);break}case"MultiLineString":{r=Rt(s);break}case"MultiPolygon":{r=Tt(s,e);break}case"GeometryCollection":{r=Ft(s,e);break}case"Circle":{r={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return r}function Ft(s,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:s.getGeometriesArray().map(function(r){return J(r,e)})}}function Gt(s,e){return{type:"LineString",coordinates:s.getCoordinates()}}function Rt(s,e){return{type:"MultiLineString",coordinates:s.getCoordinates()}}function It(s,e){return{type:"MultiPoint",coordinates:s.getCoordinates()}}function Tt(s,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:s.getCoordinates(t)}}function vt(s,e){return{type:"Point",coordinates:s.getCoordinates()}}function wt(s,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:s.getCoordinates(t)}}const Mt=ft;class Pt extends ve{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Ot,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:we,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const r=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==r?t:{});for(const i in this.tileCacheForProjection){const n=this.tileCacheForProjection[i];n.expireCache(n==r?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!O(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!O(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||O(t,e)))return this.tileGrid;const r=x(e);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=Pe(e)),this.tileGridForProjection[r]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||O(t,e))return this.tileCache;const r=x(e);return r in this.tileCacheForProjection||(this.tileCacheForProjection[r]=new Oe(this.tileCache.highWaterMark)),this.tileCacheForProjection[r]}createTile_(e,t,r,i,n,o){const a=[e,t,r],l=this.getTileCoordForTileUrlFunction(a,n),h=l?this.tileUrlFunction(l,i,n):void 0,c=new this.tileClass(a,h!==void 0?Y.IDLE:Y.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(W.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,r,i,n){const o=this.getProjection();if(!o||!n||O(o,n))return this.getTileInternal(e,t,r,i,o||n);const a=this.getTileCacheForProjection(n),l=[e,t,r];let h;const c=je(l);a.containsKey(c)&&(h=a.get(c));const d=this.getKey();if(h&&h.key==d)return h;const g=this.getTileGridForProjection(o),m=this.getTileGridForProjection(n),y=this.getTileCoordForTileUrlFunction(l,n),u=new Ae(o,g,n,m,l,y,this.getTilePixelRatio(i),this.getGutter(),(_,f,C,F)=>this.getTileInternal(_,f,C,F,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return u.key=d,h?(u.interimTile=h,u.refreshInterimChain(),a.replace(c,u)):a.set(c,u),u}getTileInternal(e,t,r,i,n){let o=null;const a=be(e,t,r),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(e,t,r,i,n,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(e,t,r,i,n,l),h.getState()==Y.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const r=A(e);if(r){const i=x(r);i in this.tileGridForProjection||(this.tileGridForProjection[i]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function Ot(s,e){s.getImage().src=e}const Ut=Pt;class jt extends Se{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=$(),this.wrappedRenderedExtent_=$(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,r){const i=t.extent,n=t.viewState,o=n.center,a=n.resolution,l=n.projection,h=n.rotation,c=l.getExtent(),d=this.getLayer().getSource(),g=t.pixelRatio,m=t.viewHints,y=!(m[L.ANIMATING]||m[L.INTERACTING]),u=this.compositionContext_,_=Math.round(t.size[0]*g),f=Math.round(t.size[1]*g),C=d.getWrapX()&&l.canWrapX(),F=C?D(c):null,R=C?Math.ceil((i[2]-c[2])/F)+1:1;let P=C?Math.floor((i[0]-c[0])/F):0;do{const w=this.getRenderTransform(o,a,h,g,_,f,P*F);e.execute(u,1,w,h,y,void 0,r)}while(++P<R)}setupCompositionContext_(){if(this.opacity_!==1){const e=Ne(this.context.canvas.width,this.context.canvas.height,q);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,Le(this.compositionContext_),q.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())}renderFrame(e,t){const r=e.pixelRatio,i=e.layerStatesArray[e.layerIndex];De(this.pixelTransform,1/r,1/r),Me(this.inversePixelTransform,this.pixelTransform);const n=Ue(this.pixelTransform);this.useContainer(t,n,this.getBackground(e));const o=this.context,a=o.canvas,l=this.replayGroup_,h=this.declutterExecutorGroup;if((!l||l.isEmpty())&&(!h||h.isEmpty()))return null;const c=Math.round(e.size[0]*r),d=Math.round(e.size[1]*r);a.width!=c||a.height!=d?(a.width=c,a.height=d,a.style.transform!==n&&(a.style.transform=n)):this.containerReused||o.clearRect(0,0,c,d),this.preRender(o,e);const g=e.viewState;g.projection,this.opacity_=i.opacity,this.setupCompositionContext_();let m=!1,y=!0;if(i.extent&&this.clipping){const u=Ke(i.extent);y=Xe(u,e.extent),m=y&&!b(u,e.extent),m&&this.clipUnrotated(this.compositionContext_,e,u)}return y&&this.renderWorlds(l,e),m&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,e),this.renderedRotation_!==g.rotation&&(this.renderedRotation_=g.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise(t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const r=[this.context.canvas.width,this.context.canvas.height];ke(this.pixelTransform,r);const i=this.renderedCenter_,n=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],d=r[0]*j,g=r[1]*j;c.push(this.getRenderTransform(i,n,o,j,d,g,0).slice());const m=h.getSource(),y=a.getExtent();if(m.getWrapX()&&a.canWrapX()&&!b(y,l)){let u=l[0];const _=D(y);let f=0,C;for(;u<y[0];)--f,C=_*f,c.push(this.getRenderTransform(i,n,o,j,d,g,C).slice()),u+=_;for(f=0,u=l[2];u>y[2];)++f,C=_*f,c.push(this.getRenderTransform(i,n,o,j,d,g,C).slice()),u-=_}this.hitDetectionImageData_=We(r,c,this.renderedFeatures_,h.getStyleFunction(),l,n,o)}t(He(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,r,i,n){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),h={},c=function(m,y,u){const _=x(m),f=h[_];if(f){if(f!==!0&&u<f.distanceSq){if(u===0)return h[_]=!0,n.splice(n.lastIndexOf(f),1),i(m,l,y);f.geometry=y,f.distanceSq=u}}else{if(u===0)return h[_]=!0,i(m,l,y);n.push(h[_]={feature:m,layer:l,geometry:y,distanceSq:u,callback:i})}};let d;const g=[this.replayGroup_];return this.declutterExecutorGroup&&g.push(this.declutterExecutorGroup),g.some(m=>d=m.forEachFeatureAtCoordinate(e,o,a,r,c,m===this.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map(y=>y.value):null)),d}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),r=t.getSource();if(!r)return!1;const i=e.viewHints[L.ANIMATING],n=e.viewHints[L.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&i||!a&&n)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,h=e.viewState,c=h.projection,d=h.resolution,g=e.pixelRatio,m=t.getRevision(),y=t.getRenderBuffer();let u=t.getRenderOrder();u===void 0&&(u=qe);const _=h.center.slice(),f=Ye(l,y*d),C=f.slice(),F=[f.slice()],R=c.getExtent();if(r.getWrapX()&&c.canWrapX()&&!b(R,e.extent)){const p=D(R),I=Math.max(D(f)/2,p);f[0]=R[0]-I,f[2]=R[2]+I,Ve(_,c);const E=Je(F[0],c);E[0]<R[0]&&E[2]<R[2]?F.push([E[0]+p,E[1],E[2]+p,E[3]]):E[0]>R[0]&&E[2]>R[2]&&F.push([E[0]-p,E[1],E[2]-p,E[3]])}if(this.ready&&this.renderedResolution_==d&&this.renderedRevision_==m&&this.renderedRenderOrder_==u&&b(this.wrappedRenderedExtent_,f))return Be(this.renderedExtent_,C)||(this.hitDetectionImageData_=null,this.renderedExtent_=C),this.renderedCenter_=_,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const P=new z(Z(d,g),f,d,g);let w;this.getLayer().getDeclutter()&&(w=new z(Z(d,g),f,d,g));let ae;for(let p=0,I=F.length;p<I;++p)r.loadFeatures(F[p],d,c);const le=$e(d,g);let H=!0;const he=p=>{let I;const E=p.getStyleFunction()||t.getStyleFunction();if(E&&(I=E(p,d)),I){const ge=this.renderFeature(p,le,I,P,ae,w);H=H&&!ge}},ce=ze(f),N=r.getFeaturesInExtent(ce);u&&N.sort(u);for(let p=0,I=N.length;p<I;++p)he(N[p]);this.renderedFeatures_=N,this.ready=H;const ue=P.finish(),de=new Q(f,d,g,r.getOverlaps(),ue,t.getRenderBuffer());return w&&(this.declutterExecutorGroup=new Q(f,d,g,r.getOverlaps(),w.finish(),t.getRenderBuffer())),this.renderedResolution_=d,this.renderedRevision_=m,this.renderedRenderOrder_=u,this.renderedExtent_=C,this.wrappedRenderedExtent_=f,this.renderedCenter_=_,this.renderedProjection_=c,this.replayGroup_=de,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,r,i,n,o){if(!r)return!1;let a=!1;if(Array.isArray(r))for(let l=0,h=r.length;l<h;++l)a=ee(i,e,r[l],t,this.boundHandleStyleImageChange_,n,o)||a;else a=ee(i,e,r,t,this.boundHandleStyleImageChange_,n,o);return a}}const At=jt;class bt extends Ze{constructor(e){super(e)}createRenderer(){return new At(this)}}const Kt=bt;class St{constructor(e){this.rbush_=new Qe(e),this.items_={}}insert(e,t){const r={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(r),this.items_[x(t)]=r}load(e,t){const r=new Array(t.length);for(let i=0,n=t.length;i<n;i++){const o=e[i],a=t[i],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};r[i]=l,this.items_[x(a)]=l}this.rbush_.load(r)}remove(e){const t=x(e),r=this.items_[t];return delete this.items_[t],this.rbush_.remove(r)!==null}update(e,t){const r=this.items_[x(t)],i=[r.minX,r.minY,r.maxX,r.maxY];oe(i,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(i){return i.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let r;for(let i=0,n=e.length;i<n;i++)if(r=t(e[i]),r)return r;return r}isEmpty(){return X(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return et(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const ne=St,G={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function Nt(s,e){return[[-1/0,-1/0,1/0,1/0]]}function Xt(s,e){return[s]}class T extends at{constructor(e,t,r){super(e),this.feature=t,this.features=r}}class Lt extends tt{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=rt,this.format_=e.format,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(S(this.format_,7),this.loader_=te(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:Nt;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new ne:null,this.loadedExtentsRtree_=new ne,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let r,i;Array.isArray(e.features)?i=e.features:e.features&&(r=e.features,i=r.getArray()),!t&&r===void 0&&(r=new it(i)),i!==void 0&&this.addFeaturesInternal(i),r!==void 0&&this.bindFeaturesCollection_(r)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=x(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const r=e.getGeometry();if(r){const i=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new T(G.ADDFEATURE,e))}setupChangeEvents_(e,t){this.featureChangeKeys_[e]=[K(t,W.CHANGE,this.handleFeatureChange_,this),K(t,nt.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(e,t){let r=!0;const i=t.getId();return i!==void 0&&(i.toString()in this.idIndex_?r=!1:this.idIndex_[i.toString()]=t),r&&(S(!(e in this.uidIndex_),30),this.uidIndex_[e]=t),r}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],r=[],i=[];for(let n=0,o=e.length;n<o;n++){const a=e[n],l=x(a);this.addToIndex_(l,a)&&r.push(a)}for(let n=0,o=r.length;n<o;n++){const a=r[n],l=x(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();t.push(c),i.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,i),this.hasListener(G.ADDFEATURE))for(let n=0,o=r.length;n<o;n++)this.dispatchEvent(new T(G.ADDFEATURE,r[n]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(G.ADDFEATURE,function(r){t||(t=!0,e.push(r.feature),t=!1)}),this.addEventListener(G.REMOVEFEATURE,function(r){t||(t=!0,e.remove(r.feature),t=!1)}),e.addEventListener(re.ADD,r=>{t||(t=!0,this.addFeature(r.element),t=!1)}),e.addEventListener(re.REMOVE,r=>{t||(t=!0,this.removeFeature(r.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const r in this.featureChangeKeys_)this.featureChangeKeys_[r].forEach(U);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const r=i=>{this.removeFeatureInternal(i)};this.featuresRtree_.forEach(r);for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new T(G.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const r=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(r,function(i){if(i.getGeometry().intersectsCoordinate(e))return t(i)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(r){if(r.getGeometry().intersectsExtent(e)){const n=t(r);if(n)return n}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),X(this.nullGeometryFeatures_)||st(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(r){t.push(r)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const i=ot(e,t);return[].concat(...i.map(n=>this.featuresRtree_.getInExtent(n)))}else if(this.featuresCollection_)return this.featuresCollection_.getArray().slice(0);return[]}getClosestFeatureToCoordinate(e,t){const r=e[0],i=e[1];let n=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||lt,this.featuresRtree_.forEachInExtent(l,function(h){if(t(h)){const c=h.getGeometry(),d=a;if(a=c.closestPointXY(r,i,o,a),a<d){n=h;const g=Math.sqrt(a);l[0]=r-g,l[1]=i-g,l[2]=r+g,l[3]=i+g}}}),n}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,r=x(t),i=t.getGeometry();if(!i)r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[r]=t);else{const o=i.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const n=t.getId();if(n!==void 0){const o=n.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[r]=t;this.changed(),this.dispatchEvent(new T(G.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:x(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&X(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,r){const i=this.loadedExtentsRtree_,n=this.strategy_(e,t,r);for(let o=0,a=n.length;o<a;++o){const l=n[o];i.forEachInExtent(l,function(c){return b(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new T(G.FEATURESLOADSTART)),this.loader_.call(this,l,t,r,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new T(G.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new T(G.FEATURESLOADERROR))}),i.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let r;t.forEachInExtent(e,function(i){if(oe(i.extent,e))return r=i,!0}),r&&t.remove(r)}removeFeature(e){if(!e)return;const t=x(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=x(e),r=this.featureChangeKeys_[t];if(!r)return;r.forEach(U),delete this.featureChangeKeys_[t];const i=e.getId();return i!==void 0&&delete this.idIndex_[i.toString()],delete this.uidIndex_[t],this.dispatchEvent(new T(G.REMOVEFEATURE,e)),e}removeFromIdIndex_(e){let t=!1;for(const r in this.idIndex_)if(this.idIndex_[r]===e){delete this.idIndex_[r],t=!0;break}return t}setLoader(e){this.loader_=e}setUrl(e){S(this.format_,7),this.url_=e,this.setLoader(te(e,this.format_))}}const kt=Lt;export{ct as F,Mt as G,ne as R,Ut as T,Kt as V,kt as a,Xt as b,ut as c,G as d};
