<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>OpenLayers Feature Frenzy</title>

		<link rel="stylesheet" href="../reveal.js/dist/reset.css">
		<link rel="stylesheet" href="../reveal.js/dist/reveal.css">
		<link id="theme" rel="stylesheet" href="../reveal.js/dist/theme/league.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="../reveal.js/plugin/highlight/monokai.css">
        
		<style>
.reveal h1,
.reveal h2,
.reveal h3,
.reveal h4,
.reveal h5,
.reveal h6 {
	text-transform: none;
}

iframe {
  margin: 0;
  padding: 0;
  border: none;
}

		</style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section id="start" data-background="../img/ol.svg" data-background-size="contain">
					
				</section>
				<section id="title" data-background="../img/ol.svg" data-background-size="contain" data-background-opacity="0.3">
					<h1>OpenLayers <br>Feature Frenzy</h1>
					<p style="margin-top: 3em;">
						M. Jansen, terrestris &amp; A. Hocevar, w3geo
					</p>
					<p style="font-size: 0.7em;">
						FOSSGIS 2023 | 15. M&auml;rz 2023 | Berlin
					</p>
				</section>

				<section id="toc">
					<h3>‚Ä¶ was in den n√§chsten 20 Mins passiert</h3>
					<ul>
						<li>Kurz zu uns und dem Vortrag</li>
						<li>OpenLayers in 120 Sekunden</li>
						<li>Feature Frenzy</li>
						<li>Ausblick, oder: Was ist in <code>ol@x.y.z</code>?</li>
					</ul>
				</section>

				<section id="meta">
					<h1 class="r-fit-text">(kurz) Meta</h1>
				</section>

				<section>
					<h3>Marc Jansen / terrestris</h3>
					  <div style="display: flex">

					  <ul style="flex: 3">
						<li>Gesch&auml;ftsf&uuml;hrer <a href="https://www.terrestris.de/">terrestris</a></li>
						<li>Kernentwickler &amp; PSC OpenLayers</li>
						<li>GeoExt, SHOGun, GeoStyler ‚Ä¶</li>
						<li>Sprecher &amp; Trainer <br /> national &amp; international</li>
						<li>OSGeo Foundation Charter Member</li>
					  </ul>
					  <div style="flex: 1; font-size: 0.5em;">
					    <img src="/img/mj.jpeg" />
						<a href="mailto:jansen@terrestris.de">jansen@terrestris.de</a>  <img style="height: 0.9em;margin:0" src="../assets/mail-logo.png" alt="E-Mail"><br />
                        <a href="https://github.com/marcjansen/">@marcjansen</a>  <img style="height: 0.9em;margin:0" src="../assets/github-logo.png" alt="GitHub"><br />
                        <a href="https://twitter.com/selectoid/">@selectoid</a> <img style="height: 0.9em;margin:0" src="../assets/twitter-logo.png" alt="Twitter"><br />
					  </div>
					</div>
				</section>

				<section>
					<h3>Andreas Hocevar / w3geo</h3>
					  <div style="display: flex">

					  <ul style="flex: 3">
						<li>Gesch&auml;ftsf&uuml;hrer <a href="https://www.w3geo.at/">w3geo</a></li>
						<li>Derzeit aktivster OpenLayers Entwickler</li>
						<li>Proj4.js, ol-mapbox-style, geotiff.js ‚Ä¶</li>
						<li>Geospatial Expert</li>
						<li>JavaScript Entwickler aus Leidenschaft</li>
					  </ul>
					  <div style="flex: 1; font-size: 0.5em;">
					    <img src="/img/ah.jpeg" />
						<a href="mailto:ahocevar@w3geo.at">ahocevar@w3geo.at</a>  <img style="height: 0.9em;margin:0" src="../assets/mail-logo.png" alt="E-Mail"><br />
                        <a href="https://github.com/ahocevar/">@ahocevar</a>  <img style="height: 0.9em;margin:0" src="../assets/github-logo.png" alt="GitHub"><br />
                        <a href="https://twitter.com/ahoce/">@ahoce</a> <img style="height: 0.9em;margin:0" src="../assets/twitter-logo.png" alt="Twitter"><br />
					  </div>
					</div>
				</section>
				</section>

				<!--section>
					<h3>Dieser Vortrag</h3>
					<ul>
						<li>Kurze einf√ºhrende Worte: Was ist OpenLayers?</li>
						<li>Schwerpunkt auf Features: Was kann <code>ol</code> so cooles?</li>
						<li>Es wird hier und da Code geben: Wie macht man das?</li>
						<li>Ausblick und wie man jenen beinflussen kann‚Ä¶</li>
					</ul>
				</section-->

				<section id="what-is-openlayers-1">
					<h3>OpenLayers ist</h3>
					<ul>
						<li>eine Web Mapping Library</li>
						<li>in JavaScript</li>
						<li>f√ºr Browser und teilweise f√ºr Node.js</li>
						<li>Open Source (BSD 2-clause)</li>
						<li>und hat eine aktive Community</li>
					</ul>
				</section>

				<section id="what-is-openlayers-2">
					<h3>OpenLayers kann</h3>
					<ul>
						<li>beliebige (Geo-)Daten zu Karten machen</li>
						<li>bei Analysen beliebiger (Geo-)Daten unterst√ºtzen</li>
						<li>g√§ngige Datenformate out-of-the-box</li>
						<li>sonstige Formate mit wenig Code</li>
						<li>und vieles mehr</li>
					</ul>
				</section>

				<section id="what-is-openlayers-3">
					<h3>OpenLayers ist im Vergleich zu</h3>
					<ul>
						<li>Leaflet: umfrangreicher, schwerer zu lernen</li>
						<li>MapLibre/Mapbox GL JS: flexibler, langsamer</li>
						<li>ArcGIS Maps SDK: ohne Vendor Lock-in</li>
					</ul>
				</section>

				<section id="the-frenzy-starts">
					<h1 class="r-fit-text">Feature Frenzy</h1>
				</section>

				<section id="ogc-standards">
					<h2>OGC Standards</h2>
					<ul>
						<li>WMS, WFS, GML - seit jeher</li>
						<li>WMTS - seit langer Zeit</li>
						<li>OGC API Tiles (Map und Vector)</li>
						<li>OGC API Styles (Mapbox)</li>
						<li>OGC API Features - teilweise</li>
					</ul>
				</section>
				
				<section id="ogc-api-tiles-vector-code">
					<h2>OGC API Tiles (Vector)</h2>
<pre><code class="lang-js">const layer = new TileLayer({
	declutter: true,
	source: new OGCVectorTile({
	  url: './ogcapi/collections/countries/tiles/WebMercatorQuad',
	  format: new MVT()
	})
});</code></pre>
				</section>

				<section id="ogc-api-tiles-vector-example" data-background-iframe="../examples/ogc-api-tiles-vector.html"></section>

				<section id="no-style">
					<h1>Kein Style??? üòï</h1>
				</section>

				<section id="ogc-api-styles-code">
					<h2>OGC API Styles (Mapbox)</h2>
<pre><code class="lang-js">import { applyStyle } from 'ol-mapbox-style';

applyStyle(layer, './ogcapi/collections/countries/styles/default.json');
</code></pre>
				</section>

				<section id="ogc-api-styles-example" data-background-iframe="../examples/ogc-api-styles.html"></section>

				<section id="no-cartography">
					<h1>Bessere Kartographie geht nicht??? üòï</h1>
				</section>

				<section id="basemap-de-code">
					<h2>basemap.de mit ol-mapbox-style üöÄ</h2>
<pre><code class="lang-js">import { apply } from 'ol-mapbox-style';

apply(
	'map',
	'https://sgx.geodatenzentrum.de/gdz_basemapde_vektor/styles/bm_web_top.json'
);
</code></pre>
				</section>

				<section id="basemap-de-example" data-background-iframe="../examples/basemap-de.html?z=13&y=52.431097&x=13.531171"></section>

				<section id="basemap-de-not-this-code">
					<h2>So kann man auch, muss man aber nicht üò±</h2>
<pre><code style="text-decoration-color: rgba(128, 128, 128, 0.5); text-decoration-line: line-through">var center = [10, 51];
const mbMap = new mapboxgl.Map({
	style: 'https://sgx.geodatenzentrum.de/gdz_basemapde_vektor/styles/bm_web_top.json',
	center: center,
	container: 'map',
});
const mbLayer = new Layer({
	render(frameState) {
		const canvas = mbMap.getCanvas();
		const viewState = frameState.viewState;
		mbMap.jumpTo({
			center: toLonLat(viewState.center),
			zoom: viewState.zoom - 1,
			animate: false
		});
		return canvas;
  }
});
const map = new Map({
	layers: [mbLayer],
	target: 'map',
	view: new View({
		center: fromLonLat(center),
		zoom: 6
	})
});
</code></pre>
				</section>

				<section id="spatial-analysis">
					<h2>R√§umliche Analyse</h2>
					<ul>
						<li>Eingebaute Vektor- und Rasteranalysefunktionen</li>
						<li>Kombinierbar mit Turf.js, geotiff.js, ...</li>
						<li>Analytische und grafische Ans√§tze m√∂glich</li>
						<li>Elemente zur interaktiven Benutzerf√ºhrung</li>
						<li>Die M√∂glichkeiten sind fast grenzenlos!</li>
					</ul>
					<div style="text-align: right;"><a target="_blank" href="https://agraratlas.inspire.gv.at">agraratlas.inspire.gv.at</a></div>
				</section>

				<section id="spatial-analysis-example" data-background-iframe="../examples/gradient.html"></section>

				<section id="show-me-how">
					<h1>Zeig mir wie! ü§î</h1>
				</section>

				<section id="dtm">
					<img src="../img/dtm.png">
				</section>

				<section id="dtm-code-layer">
					<h2>Image Tiles mit beliebigen Daten bef√ºllen</h2>
<pre><code class="lang-js">const canvas = document.createElement('canvas');
const context = canvas.getContext('2d');

layer.setTileLoadFunction(async (tile, src) => {
	const tileCoord = tile.getTileCoord();
	const extent = tileGrid.getTileCoordExtent(tileCoord);
	const resolution = tileGrid.getResolution(tileCoord[0])
	const tileSize = tileGrid.getTileSize(tileCoord[0]);
	canvas.width = tileSize;
	canvas.height = tileSize;
	const {gradientImageData} =
	  await getGradientData(extent, tileSize, tileSize, resolution);
	context.putImageData(gradientImageData, 0, 0);
	tile.getImage().src = canvas.toDataURL('image/png');
};
</code></pre>
				</section>

				<section id="dtm-code-geotiff">
					<h2>H√∂henmodell zu Hangneigungsklassen</h2>
<pre><code class="lang-js">async function getGradientData(bbox, width, height, resolution) {
	// H√∂hen aus dem geotiff laden
  const dtm = (await geotiff.readRasters({ bbox, width, height }))[0];
  const gradientData = new Uint8ClampedArray(width * height);
	// bef√ºllen mit den Hangneigungsklassen
	// https://pro.arcgis.com/en/pro-app/2.9/tool-reference/spatial-analyst/how-slope-works.htm
  const gradientImageData = context.createImageData(width, height);
	// bef√ºllen mit Farben f√ºr Hangneigungsklassen
  return {gradientData, gradientImageData};
}
</code></pre>
					<div style="text-align: right;"><a target="_blank" href="https://data.bev.gv.at/geonetwork#/metadata/0365b53c-170b-41ef-962e-44645084f254">data.bev.gv.at</a></div>
				</section>

				<section id="mask">
					<img src="../img/mask.png">
				</section>

				<section id="headless-map-code">
					<h2>Headless Map</h2>
<pre><code class="lang-js">const target = document.createElement('div');
const headlessMap = new Map({
	target,
	pixelRatio: 1,
	layers: [new VectorLayer({ source: selected, style: blackFill })],
	view: new View({
		resolution: 1,
		center: getCenter(geomExtent)
	})
});
headlessMap.setSize([getWidth(geomExtent), getHeight(geomExtent)]);
headlessMap.renderSync();
const imageURL = target.querySelector('canvas').toDataURL('image/png');
</code></pre>
				</section>

				<section id="calculate">
					<img src="../img/calculate.png">
				</section>

				<section id="calculate-code">
					<h2>Verschneidung Hangneigungsklasse - Schlag</h2>
					<img src="../img/subpixel.png" style="width: 500px">
<pre><code class="lang-js">for (let y = 0; y &lt; height; y++) {
	for (let x = 0; x &lt; width; x++) {
		const maskPixel = schlagImageData.slice(4 * (y * width + x), 4);
		const alpha = maskPixel[3] / 255;
		if (alpha > 0) {
			const area = resolution * resolution * alpha;
			classes[gradientData[y * width + x]] += area;
		}
	}
}
</code></pre>
				</section>

				<section id="tracing-example">
					<iframe class="stretch" src="../examples/tracing.html"></iframe>
					<h3>Tracing</h3>
				</section>

				<section>
					<h2>Tracing</h2>
					<pre><code class="lang-js">const drawInteraction = new Draw({
	type: 'Polygon',
	source: drawVector.getSource(),
	trace: true,
	traceSource: baseVector.getSource(),
	style: {
		'stroke-color': 'rgba(255, 255, 100, 0.5)',
		'stroke-width': 1.5,
		'fill-color': 'rgba(255, 255, 100, 0.25)',
		'circle-radius': 6,
		'circle-fill-color': 'rgba(255, 255, 100, 0.5)',
	},
});</code></pre>
				</section>

				<section id="germany-example">
					<iframe class="stretch" src="../examples/germany.html"></iframe>
					<h3>Rasterprozessierung</h3>
				</section>

				<section>
					<h2>Rasterstyle</h2>
					<pre><code class="lang-js">const classes = {
	'10': 'forest',
	'20': 'low vegetation',
	'30': 'water',
	'40': 'built-up',
	'50': 'bare soil',
	'60': 'agriculture'
}</code></pre>
				</section>

				<section>
					<h2>Rasterstyle</h2>
					<pre><code class="lang-js">// band 1 is 2020, band 2 is 2016
{
	color: [
		'case',
		['==', ['band', 1], ['band', 2]],
		[0, 0, 0, 0], // equal, make them transparent
		['all', ['==', ['band', 1], 10], ['!=', ['band', 2], 10] ],
		[30, 240, 0, 1], // wald in 2020, irgendwas nicht waldiges in 2016
		['all', ['==', ['band', 2], 10], ['!=', ['band', 1], 10] ],
		[240, 10, 0, 1], // wald in 2016, irgendwas nicht waldiges in 2020
		['all', ['==', ['band', 1], 40], ['!=', ['band', 2], 40] ],
		[255, 255, 255, 1], // built-up in 2020, irgendwas nicht built-up in 2016
		[0, 0, 0, 0] // hide any other differences
	]
}</code></pre>
				</section>

				<section>
					<h3>2 &times; ca. 450 MB => 900 MB</h3>
					<h3></h3>
					<h3>12 &times; ca. 66kB=> ca. 800 kB</h3>
					<h3></h3>
					<p>&nbsp;</p>
					<h3>‚Ä¶und das skaliert ganz wunderbar‚Ä¶</h3>
				</section>

				<section>
					<h3><a href="https://github.com/protomaps/PMTiles">PMTiles</a></h3>
					<ul>
						<!-- <li>https://pub-9288c68512ed46eca46ddcade307709b.r2.dev/protomaps-sample-datasets/terrarium_z9.pmtiles</li> -->
						<li>30.543.645.671 Bytes (28G)</li>
					</ul>
					<img class="stretch" src="/img/http.png">
				</section>

				<section id="pmtiles-example">
					<iframe class="stretch" src="../examples/pmtiles.html"></iframe>
					<h3>PMTiles</h3>
				</section>

				<section id="future-in-progress">
					<h1 class="r-fit-text">Flie√üender √úbergang zum Ausblick</h1>
				</section>

				<section id="experiment-particle-flow-input">
					<img class="stretch" src="../img/wind.png"></iframe>
					<h3>Caveat &amp; WIP: Particle Flow</h3>
				</section>

				<section id="experiment-particle-flow">
					<iframe class="stretch" src="https://deploy-preview-14491--ol-site.netlify.app/en/latest/examples/wind.html"></iframe>
					<h3>Caveat &amp; WIP: Particle Flow, <a href="https://github.com/openlayers/openlayers/pull/14491">#14491</a></h3>
				</section>
				
				<section id="experiment-particle-flow-inspiration">
					<iframe class="stretch" src="https://mapbox.github.io/webgl-wind/demo/"></iframe>
					<h3>inspired by <a href="https://mapbox.github.io/webgl-wind/demo/">WebGL-Wind Map</a> / MapBox, <a href="https://blog.mapbox.com/how-i-built-a-wind-map-with-webgl-b63022b5537f">V. Agafonkin</a></h3>
				</section>

				<section id="future">
					<h1 class="r-fit-text">Ausblick</h1>
				</section>

				<section>
					<ul>
						<li>Mehr WebGL (eigener Vortrag)</li>
						<li>It's always been you, Canvas 2D - Offscreen Canvas!</li>
						<li>Web Workers</li>
						<li>STAC</li>
						<li>...</li>
					</ul>
				</section>

				<section>
					<ul>
						<li>Mature Library - keine fixe Roadmap</li>
						<li>Interessen und Contributions bestimmen die Richtung</li>
						<li>OpenLayers Sponsoring f√ºr Code Sprints etc.</li>
						<li>Entwickler Sponsoring f√ºr Maintenance & Features</li>
					</ul>
					<br><br>
					<div style="text-align: right;"><a target="_blank" href="https://github.com/sponsors/openlayers">github.com/sponsors/openlayers</a></div>
					<div style="text-align: right;"><a id="sponsor-dev"></a></div>
					<script>
						const devs = ['tschaub', 'ahocevar', 'twpayne', 'fredj', 'elemoine', 'crschmidt', 'marcjansen', 'mike-000', 'jahow', 'probins', 'MoonE', 'schuyler', 'bartvde', 'tonio', 'gberaudo', 'petrsloup', 'simonseyock', 'bbinet', 'fgravin', 'GaborFarkas', 'pgiraud', 'pagameba', 'schmidtk', 'bjornharrtell']
						const sponsorDev = document.getElementById('sponsor-dev');
						let index = 0;
						setInterval(() => {
							const link = `github.com/sponsors/${devs[index]}`;
							sponsorDev.target = '_blank';
							sponsorDev.href = 'https://' + link;
							sponsorDev.innerText = link;
							index = ++index % devs.length;
						}, 500);
					</script>
			
				</section>
				
				<section id="thanks-questions">
					<h2>Danke!</h2>
					<h2>Fragen oder Anmerkungen?</h2>
				</section>

				<section id="imprint" style="font-size: smaller;">
					<h3>Impressum</h3>
					<h5>Autoren &amp; Kontakt</h5>
					<div style="display: flex;">
						<address style="flex: 1">
							<strong>Marc Jansen</strong><br>
							terrestris GmbH &amp; Co. KG<br>
							K√∂lnstr. 99<br>
							53111 Bonn<br>
							Deutschland<br>
							<a href="mailto:jansen@terrestris.de">jansen@terrestris.de</a><br>
						</address>
						<address style="flex: 1">
							<strong>Andreas Hocevar</strong><br>
							w3geo GmbH<br>
							Seidengasse 46<br>
							1070 Wien<br>
							√ñsterreich<br>
							<a href="mailto:ahocevar@w3geo.at">ahocevar@w3geo.at</a>
						</address>
					</div>		
					<h5 style="margin-top: 1em;">Lizenz</h5>
					<p>Diese Folien sind unter <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA</a> ver√∂ffentlicht.
					</p>
					</div>
                </section>
			</div>
		</div>

		<script src="../reveal.js/dist/reveal.js"></script>
		<script src="../reveal.js/plugin/notes/notes.js"></script>
		<script src="../reveal.js/plugin/markdown/markdown.js"></script>
		<script src="../reveal.js/plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				width: 1080,
				// height: '100%',
				// margin: 0.01,
				// works but needs love
				// disableLayout: true,
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});

			// Reveal.addEventListener( 'brightside', function() {
			// 	document.getElementById('theme').setAttribute('href','../reveal.js/dist/theme/white.css'); 
			// }, false );
			// Reveal.addEventListener( 'darkside', function() {
			// 	document.getElementById('theme').setAttribute('href','../reveal.js/dist/theme/black.css'); 
			// }, false );
		</script>
	</body>
</html>
